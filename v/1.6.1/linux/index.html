<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Astra Yocto Linux User Guide &mdash; Synaptics Astra SDK User Guide 1.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/css/synaptics.css?v=fae16d89" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b79f0e1f"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Astra Yocto Linux Developer Guide" href="../yocto.html" />
    <link rel="prev" title="Building and installing a custom system image" href="../quickstart/build_image.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #007dc3" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_full_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Astra Yocto Linux User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-hardware">Supported Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interfacing-with-astra-machina">Interfacing with Astra Machina</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-graphical-desktop">The Graphical Desktop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#x11-support">X11 Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dual-displays">Dual Displays</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-shell-with-ssh">The Shell with SSH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-shell-with-adb">The Shell with ADB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-serial-console">The Serial Console</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-serial-console">Setting up the Serial Console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-os-login">Linux OS Login</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multimedia">Multimedia</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gstreamer-plugins">Gstreamer Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#video-codecs">Video Codecs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audio-codecs">Audio Codecs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gstreamer-examples">Gstreamer Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#media-playback">Media Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audio-playback">Audio Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#video-playback">Video Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#audio-video-file-playback">Audio / Video File Playback</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recording">Recording</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cameras">Cameras</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdmi-rx">HDMI-RX</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gstreamer-playbin-plugin">Gstreamer Playbin Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gstreamer-synap-plugin">GStreamer SyNAP Plugin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multimedia-demo-applications">Multimedia Demo Applications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#multimedia-demo-customization">Multimedia Demo Customization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syna-video-player">Syna Video Player</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syna-ai-player">Syna AI Player</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-with-synap">Machine Learning with SyNAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connectivity">Connectivity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-wifi-with-wpa-supplicant">Setting up Wifi with WPA Supplicant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generate-the-wpa-pre-shared-key">Generate the WPA Pre-shared Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bringing-up-the-wlan-interface">Bringing up the WLAN Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-wpa-supplicant-configuration-file">Creating the WPA Supplicant Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-systemd-networkd">Configure systemd-networkd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-wifi-services">Enable Wifi Services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-the-access-point-ap-mode-with-hostapd">Setup the Access Point (AP mode) with hostapd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-networking-to-use-hostapd">Configure Networking to use hostapd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Configure systemd-networkd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-hostapd">Configure hostapd</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-ip-forwarding-firewall-rules">Configuring IP Forwarding Firewall Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-services">Enabling Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="#verify-wlan0-interface-configuration">Verify wlan0 Interface Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#disabling-services">Disabling Services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#performing-throughput-tests">Performing throughput tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tcp-traffic">TCP Traffic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#udp-traffic">UDP Traffic</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-iperf-options">Common iPerf Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-bluetooth-a2dp-source-role">Using the Bluetooth A2DP source role</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#searching-and-connecting-to-the-headset">Searching and connecting to the headset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#playing-music-to-the-headset">Playing music to the headset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-linux-boot-process">The Linux Boot Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#software-overview">Software Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preboot-firmware">Preboot Firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bootloader">Bootloader</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-kernel-and-device-tree">Linux Kernel and Device Tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#root-file-system">Root File System</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#u-boot">U-Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#booting-from-spi-and-sd-cards">Booting from SPI and SD Cards</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generating-bootable-sd-card-images">Generating Bootable SD Card Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-bootable-images-to-the-sd-card">Writing Bootable Images to the SD Card</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#u-boot-prompt-with-su-boot">U-Boot Prompt with SU-Boot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#updating-astra-software">Updating Astra Software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-astra-system-image">The Astra System Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-software-images-using-usb">Updating Software Images using USB</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-usb-boot-environment">Setting up the USB Boot Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-winusb-driver-windows-only">Installing the WinUSB Driver (Windows Only)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-astra-update">Running Astra Update</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updating-images-from-u-boot">Updating Images from U-Boot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-u-boot-environment">Setting up the U-Boot Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-u-boot-from-the-emmc">Loading U-Boot from the eMMC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-u-boot-from-internal-spi-flash">Loading U-Boot from internal SPI flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flashing-images-from-a-usb-drive">Flashing Images from a USB Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flashing-images-from-a-tftp-server">Flashing Images from a TFTP Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updating-internal-spi-flash-images-using-u-boot">Updating Internal SPI Flash Images using U-Boot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flashing-image-from-an-external-usb-drive">Flashing Image from an External USB Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flashing-image-from-tftp-server">Flashing Image from TFTP Server</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yocto.html">Astra Yocto Linux Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subject/index.html">Subject Specific User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appnotes/index.html">Application Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw/index.html">Astra Machina Eval Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">SDK Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #007dc3" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Synaptics Astra SDK User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Astra Yocto Linux User Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="astra-yocto-linux-user-guide">
<h1>Astra Yocto Linux User Guide<a class="headerlink" href="#astra-yocto-linux-user-guide" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This document describes the Synaptics Astra Linux OS environment and
Board Support Package (BSP). It provides information on the components
which make up the BSP and how to interface with them.</p>
<section id="supported-hardware">
<h3>Supported Hardware<a class="headerlink" href="#supported-hardware" title="Permalink to this heading"></a></h3>
<p>The following Reference Kits and platforms are covered by this guide:</p>
<ul class="simple">
<li><p>Astra Machina (Foundation) SL1620</p></li>
<li><p>Astra Machina (Foundation) SL1640</p></li>
<li><p>Astra Machina (Foundation) SL1680</p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://synaptics-synap.github.io/doc/v/3.0.0/">SyNAP User Guide</a></p></li>
</ul>
</section>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>The Synaptics Linux Board Support Package (BSP) contains the software
and firmware required to operate Astra Machina. It contains the
components needed to boot OSes and interface with the hardware. This
guide provides a description of these software components and information
on how to interface with them. This document is useful for users who
want to evaluate Astra Machina and build products using these processors.</p>
<p>This document covers the components which are used by the Linux OS. For
instructions on setting up the build environment and creating a Yocto-based
image for Astra Machina, please see the <a class="reference internal" href="../yocto.html"><span class="doc">Astra Yocto Linux Developer Guide</span></a>.</p>
<p>Specific information about the Astra Machina hardware can be found on the <a class="reference internal" href="../hw/index.html"><span class="doc">Astra Machina Eval Platform</span></a> page
and source code repositories can be found on the <a class="reference external" href="https://github.com/synaptics-astra">Synaptics Astra GitHub page</a>.</p>
</section>
<section id="interfacing-with-astra-machina">
<h2>Interfacing with Astra Machina<a class="headerlink" href="#interfacing-with-astra-machina" title="Permalink to this heading"></a></h2>
<p>Several methods exist for interfacing with Astra Machina, including using a graphical desktop
on an external display. Additionally, Shell access is available through SSH, ADB, and the serial console.</p>
<section id="the-graphical-desktop">
<h3>The Graphical Desktop<a class="headerlink" href="#the-graphical-desktop" title="Permalink to this heading"></a></h3>
<p>Astra Machina’s graphical desktop is enabled by default. It can be displayed on an external display connected
to the HDMI port or a MIPI display. Input can be provided by connecting a standard HID USB keyboard and mouse.
The Wayland / Weston display server is used by default, but Astra Machina can be configured to use X11 instead
when building a custom image. <a class="reference internal" href="../yocto.html"><span class="doc">Astra Yocto Linux Developer Guide</span></a></p>
<figure class="align-default" id="id5">
<img alt="../_images/wayland-desktop.jpg" src="../_images/wayland-desktop.jpg" />
<figcaption>
<p><span class="caption-text">The Wayland Desktop on Astra Machina</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Clicking on the icon in the top left corner will open a terminal.</p>
<figure class="align-default" id="id6">
<img alt="../_images/wayland-terminal.jpg" src="../_images/wayland-terminal.jpg" />
<figcaption>
<p><span class="caption-text">The Wayland Desktop with a terminal open</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="x11-support">
<h4>X11 Support<a class="headerlink" href="#x11-support" title="Permalink to this heading"></a></h4>
<p>X11 supports two desktop environments. By default, SL1680 is configured to use <a class="reference external" href="https://www.xfce.org/">XFCE4</a> and SL1620 / SL1640
use <a class="reference external" href="https://layers.openembedded.org/layerindex/recipe/300718/">Matchbox</a>.</p>
<figure class="align-default" id="id7">
<img alt="../_images/sl1680-xfce4-desktop.jpg" src="../_images/sl1680-xfce4-desktop.jpg" />
<figcaption>
<p><span class="caption-text">The XFCE4 Desktop Environment on SL1680</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id8">
<img alt="../_images/sl1680-xfce4-windows.jpg" src="../_images/sl1680-xfce4-windows.jpg" />
<figcaption>
<p><span class="caption-text">The XFCE4 Desktop Environment with a terminal and file manager on SL1680</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id9">
<img alt="../_images/sl1640-matchbox.jpg" src="../_images/sl1640-matchbox.jpg" />
<figcaption>
<p><span class="caption-text">The Matchbox Desktop Environment on SL1640</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id10">
<img alt="../_images/sl1640-matchbox-terminal.jpg" src="../_images/sl1640-matchbox-terminal.jpg" />
<figcaption>
<p><span class="caption-text">The Matchbox Desktop Environment with a terminal open on SL1640</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On SL1620, the output mode has to be set explicitly to avoid scaling issues:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">DISPLAY</span><span class="o">=</span><span class="p">:</span><span class="mi">0</span>
<span class="n">xrandr</span> <span class="o">-</span><span class="n">s</span> <span class="mi">800</span><span class="n">x480</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>PulseAudio is not configured so X11 media players like <code class="docutils literal notranslate"><span class="pre">Parole</span></code> will not have
working audio.</p>
</div>
</section>
<section id="dual-displays">
<h4>Dual Displays<a class="headerlink" href="#dual-displays" title="Permalink to this heading"></a></h4>
<p>SL1620 and SL1680 support dual display configurations. SL1620 supports a TFT display plus an HDMI display
(via onboard DSI to MIPI converter on REV D boards). SL1620 can also be configured to use a MIPI panel instead
of HDMI by enabling a device tree overlay. Astra Machina include device tree overlays for the Waveshare panel
<code class="docutils literal notranslate"><span class="pre">myna2-ws-panel-overlay.dtbo</span></code> and the Haier panel <code class="docutils literal notranslate"><span class="pre">myna2-haier-panel-overlay.dtbo</span></code>.</p>
<p>SL1680 supports an HDMI display plus a MIPI DSI. By default, the Waveshare panel is enabled as the secondary display.
But, Astra Machina supports using the Haier panel by enabling the <code class="docutils literal notranslate"><span class="pre">dolphin-haier-panel-overlay.dtbo</span></code> device tree overlay.
Both displays can be configured to run Weston, KMS, or a combination of Weston + KMS.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mirroring of display output is not supported.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dual Display is not supported with X11.</p>
</div>
</section>
</section>
<section id="the-shell-with-ssh">
<h3>The Shell with SSH<a class="headerlink" href="#the-shell-with-ssh" title="Permalink to this heading"></a></h3>
<p>Astra Machina has ssh enabled by default. It will accept connections from ssh
clients over the network. Login with the username <code class="docutils literal notranslate"><span class="pre">root</span></code>. No password is required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">root</span><span class="o">@</span><span class="mf">10.10.10.100</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the examples above the Astra Machina’s address is
10.10.10.100. Please replace this IP with the IP address of your device.</p>
</div>
</section>
<section id="the-shell-with-adb">
<span id="adb-shell-guide"></span><h3>The Shell with ADB<a class="headerlink" href="#the-shell-with-adb" title="Permalink to this heading"></a></h3>
<p>Astra Machina supports Android Debug Bridge (ADB) over USB. ADB is used on Android devices and has been
ported to Astra Machina. Google provides extensive documentation on ADB <a class="reference external" href="https://developer.android.com/tools/adb">here</a>.</p>
<p>To use ADB connect a USB cable from the host system to the USB Type-C USB 2.0 port on Astra Machina (next to the ethernet port).</p>
<figure class="align-default" id="id11">
<img alt="../_images/usb-c.png" src="../_images/usb-c.png" />
<figcaption>
<p><span class="caption-text">Astra Machina Component Diagram with USB Type-C USB 2.0 port highlighted</span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Google provides versions of ADB for Mac, Linux, and Windows. Once ADB is installed run <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">devices</span></code> to see all ADB devices
connected to the host. Then run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">shell</span>
</pre></div>
</div>
<p>Or if there is more then one ADB device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="o">-</span><span class="n">s</span> <span class="n">SL16x0</span> <span class="n">shell</span>
</pre></div>
</div>
<figure class="align-default" id="id12">
<img alt="../_images/powershell-adb.png" src="../_images/powershell-adb.png" />
<figcaption>
<p><span class="caption-text">Using ADB with Windows Powershell</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="the-serial-console">
<h3>The Serial Console<a class="headerlink" href="#the-serial-console" title="Permalink to this heading"></a></h3>
<p>Astra Machina provides a serial console which displays bootloader
and OS messages to a terminal emulator running on the host system. These messages are
useful for determining the status of Astra Machina early in the boot process
or when a display is not connected. It can also provides useful information
during operation. The serial console is also needed during the software update process.</p>
<section id="setting-up-the-serial-console">
<span id="setup-serial-console"></span><h4>Setting up the Serial Console<a class="headerlink" href="#setting-up-the-serial-console" title="Permalink to this heading"></a></h4>
<p>The serial console on Astra Machina can be accessed by connecting a USB-TTL adaptor to
the RX, TX, and GND pins of the 40 pin GPIO connector. USB-TTL adaptors can either be a board
with jumper wires or an integrated USB cable with separated pins.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>USB TTL</p></th>
<th class="head"><p>Astra Machina</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GND</p></td>
<td><p>GND (Pin 6)</p></td>
</tr>
<tr class="row-odd"><td><p>RXD</p></td>
<td><p>TX  (Pin 8)</p></td>
</tr>
<tr class="row-even"><td><p>TXD</p></td>
<td><p>RX  (Pin 10)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RX and TX pins operate at a typical voltage of 3.3V</p>
</div>
<p>The following USB-TTL adaptors are officially approved to work with Astra Machina:</p>
<p><a class="reference external" href="https://www.adafruit.com/product/954#technical-details">Adafruit USB to UART Debug / Console Cable (CP2102 Driver IC)</a></p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin Function</p></th>
<th class="head"><p>Color Code</p></th>
<th class="head"><p>Astra SL16x0 40-pin Connector</p></th>
<th class="head"><p>Astra SL16x0 40-pin Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5V-Out</p></td>
<td><p>Red</p></td>
<td><p>NC</p></td>
<td><p>NC</p></td>
</tr>
<tr class="row-odd"><td><p>TX-Out</p></td>
<td><p>Green</p></td>
<td><p>Pin-10</p></td>
<td><p>UART0_Rx-In</p></td>
</tr>
<tr class="row-even"><td><p>RX-In</p></td>
<td><p>White</p></td>
<td><p>Pin-8</p></td>
<td><p>UART0_Tx-Out</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>Black</p></td>
<td><p>Pin-6</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><cite>CenryKay USB to UART Debug / Console Cable (CH340G Driver IC)</cite></p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pin Function</p></th>
<th class="head"><p>Color Code</p></th>
<th class="head"><p>Astra SL16x0 40-pin Connector</p></th>
<th class="head"><p>Astra SL16x0 40-pin Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5V-Out</p></td>
<td><p>Red</p></td>
<td><p>NC</p></td>
<td><p>NC</p></td>
</tr>
<tr class="row-odd"><td><p>TX-Out</p></td>
<td><p>Green</p></td>
<td><p>Pin-10</p></td>
<td><p>UART0_Rx-In</p></td>
</tr>
<tr class="row-even"><td><p>RX-In</p></td>
<td><p>White</p></td>
<td><p>Pin-8</p></td>
<td><p>UART0_Tx-Out</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>Black</p></td>
<td><p>Pin-6</p></td>
<td><p>GND</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>USB-TTL cables using PL2303 or FT232R driver ICs are not approved parts for use with Astra Machina.</p>
</div>
<figure class="align-default" id="id13">
<img alt="../_images/usb-ttl-board.png" src="../_images/usb-ttl-board.png" />
<figcaption>
<p><span class="caption-text">Example USB TTL board</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id14">
<img alt="../_images/usb-ttl-cable.png" src="../_images/usb-ttl-cable.png" />
<figcaption>
<p><span class="caption-text">Example USB TTL cable</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id15">
<img alt="../_images/board-ports.png" src="../_images/board-ports.png" />
<figcaption>
<p><span class="caption-text">Astra Machina with 40 GPIO Header labeled</span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id16">
<img alt="../_images/40-pin-connector.png" src="../_images/40-pin-connector.png" />
<figcaption>
<p><span class="caption-text">Astra Machina’s 40 Pin GPIO Header pinout</span><a class="headerlink" href="#id16" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Some USB-TTL adaptors require installing a driver on Windows and Mac hosts. Please check with the
adaptor’s manufacturer for instructions on downloading and installing the driver.</p>
<p>The serial console can be accessed using a terminal emulator program such as <a class="reference external" href="https://www.putty.org/">Putty</a>, HyperTerminal,
<a class="reference external" href="https://teratermproject.github.io/index-en.html">Tera Term</a>, Screen, or Minicom.</p>
<figure class="align-default" id="id17">
<img alt="../_images/putty.png" src="../_images/putty.png" />
<figcaption>
<p><span class="caption-text">Putty terminal emulator on Windows</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id18">
<img alt="../_images/configure-minicom.png" src="../_images/configure-minicom.png" />
<figcaption>
<p><span class="caption-text">Minicon terminal emulator on Mac OS</span><a class="headerlink" href="#id18" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="linux-os-login">
<span id="linux-login"></span><h4>Linux OS Login<a class="headerlink" href="#linux-os-login" title="Permalink to this heading"></a></h4>
<p>After Linux successfully boots, a login prompt will be displayed in the
serial console. To login use the username <code class="docutils literal notranslate"><span class="pre">root</span></code>. No password is required.</p>
<figure class="align-default" id="id19">
<img alt="../_images/login-prompt.png" src="../_images/login-prompt.png" />
<figcaption>
<p><span class="caption-text">Successful boot seen in Minicom</span><a class="headerlink" href="#id19" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="multimedia">
<span id="id1"></span><h2>Multimedia<a class="headerlink" href="#multimedia" title="Permalink to this heading"></a></h2>
<p>The Astra Machina contains hardware and software components which accelerate
the processing of multimedia workloads. The Linux BSP provides Gstreamer
plugins which allow users to develop programs which utilize these
multimedia components to improve multimedia performance. This section
provides an overview on how to use the Gstreamer command line interface
to build pipelines using these plugins. Information on the Gstreamer framework
can be found at <a class="reference external" href="https://gstreamer.freedesktop.org/">https://gstreamer.freedesktop.org/</a>.</p>
<section id="gstreamer-plugins">
<h3>Gstreamer Plugins<a class="headerlink" href="#gstreamer-plugins" title="Permalink to this heading"></a></h3>
<p>Gstreamer uses plugin modules which are used to extend Gstreamer functionality.
The Astra Machina uses plugins to allow its hardware components to be used
in a Gstreamer pipeline. The tables below list plugins which are used by
the codecs supported by the Astra Machina.</p>
<section id="video-codecs">
<h4>Video Codecs<a class="headerlink" href="#video-codecs" title="Permalink to this heading"></a></h4>
<p><strong>SL1620</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Codec</p></th>
<th class="head"><p>Parser Plugin</p></th>
<th class="head"><p>Decoder Plugin</p></th>
<th class="head"><p>Encoder Plugin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>H.264</p></td>
<td><p>h264parse</p></td>
<td><p>avdec_h264</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>H.265</p></td>
<td><p>h265parse</p></td>
<td><p>avdec_h265</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>VP8</p></td>
<td><p>N/A</p></td>
<td><p>avdec_vp8</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p>VP9</p></td>
<td><p>vp9parse</p></td>
<td><p>avdec_vp9</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
<p><strong>SL1640 / SL1680</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Codec</p></th>
<th class="head"><p>Parser Plugin</p></th>
<th class="head"><p>Decoder Plugin</p></th>
<th class="head"><p>Encoder Plugin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>H.264</p></td>
<td><p>h264parse</p></td>
<td><p>v4l2h264dec</p></td>
<td><p>v4l2h264enc</p></td>
</tr>
<tr class="row-odd"><td><p>H.265</p></td>
<td><p>h265parse</p></td>
<td><p>v4l2h265dec</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>VP8</p></td>
<td><p>N/A</p></td>
<td><p>v4l2vp8dec</p></td>
<td><p>v4l2vp8enc</p></td>
</tr>
<tr class="row-odd"><td><p>VP9</p></td>
<td><p>vp9parse</p></td>
<td><p>v4l2vp9dec</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>AV1</p></td>
<td><p>av1parse</p></td>
<td><p>v4l2av1dec</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</section>
<section id="audio-codecs">
<h4>Audio Codecs<a class="headerlink" href="#audio-codecs" title="Permalink to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Codec</p></th>
<th class="head"><p>Parser Plugin</p></th>
<th class="head"><p>Decoder Plugin</p></th>
<th class="head"><p>Encoder Plugin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AAC</p></td>
<td><p>aacparse</p></td>
<td><p>fdkaacdec</p></td>
<td><p>fdkaacenc</p></td>
</tr>
<tr class="row-odd"><td><p>Vorbis</p></td>
<td><p>N/A</p></td>
<td><p>vorbisdec</p></td>
<td><p>vorbisenc</p></td>
</tr>
<tr class="row-even"><td><p>MPEG 2</p></td>
<td><p>mpegaudioparse</p></td>
<td><p>avdec_mp2float</p></td>
<td><p>avenc_mp2</p></td>
</tr>
<tr class="row-odd"><td><p>MPEG 3</p></td>
<td><p>mpegaudioparse</p></td>
<td><p>avdec_mp3</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p>AC3</p></td>
<td><p>N/A</p></td>
<td><p>avdec_ac3</p></td>
<td><p>avenc_ac3</p></td>
</tr>
<tr class="row-odd"><td><p>OPUS</p></td>
<td><p>N/A</p></td>
<td><p>avdec_opus</p></td>
<td><p>avenc_opus</p></td>
</tr>
</tbody>
</table>
<section id="plugin-information">
<h5>Plugin Information<a class="headerlink" href="#plugin-information" title="Permalink to this heading"></a></h5>
<p>Astra Machina includes the <code class="docutils literal notranslate"><span class="pre">gst-inspect-1.0</span></code> command which can be used to display information about the
plugins available on the system.</p>
<figure class="align-default" id="id20">
<img alt="../_images/gst-inspect-synainfer.png" src="../_images/gst-inspect-synainfer.png" />
<figcaption>
<p><span class="caption-text">Example output of <code class="docutils literal notranslate"><span class="pre">gst-inspect-1.0</span> <span class="pre">--no-colors</span> <span class="pre">synapinfer</span></code></span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need the –no-colors option to disable colors if your terminal does not support colors.</p>
</div>
</section>
</section>
</section>
<section id="gstreamer-examples">
<h3>Gstreamer Examples<a class="headerlink" href="#gstreamer-examples" title="Permalink to this heading"></a></h3>
<p>The following examples use the gst-launch-1.0 command line program to
construct a pipeline and begin playing it. The gst-launch-1.0 command
takes in a list of element types separated by exclamation points.
Elements can also contain optional properties. (see <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/gstreamer-tools.html?gi-language=c">GStreamer documentation</a> for more details).
The examples below will show the structure of the command with a brief description.
Followed by one or more examples.</p>
<section id="media-playback">
<h4>Media Playback<a class="headerlink" href="#media-playback" title="Permalink to this heading"></a></h4>
<section id="audio-sinks">
<span id="id2"></span><h5>Audio Sinks<a class="headerlink" href="#audio-sinks" title="Permalink to this heading"></a></h5>
<p>The following examples use the ALSA audio sink to output audio using the ALSA
audio API (for more details refer to the <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/alsa/alsasink.html?gi-language=c#alsasink">Gstreamer documentation</a> for more details).
The examples use the device hw:0,7 which corresponds to
the HDMI output device on SL1680. Hardware devices can be found in the file
/proc/asound/pcm. Below is an example of the pcm devices on SL1680.
Device 0-7 corresponds to the HDMI device and will be used in the
examples below.</p>
<p>Example /proc/asound/pcm output from SL1680:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1680</span><span class="p">:</span><span class="o">~</span><span class="c1"># cat /proc/asound/pcm</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">00</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">i2so1</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">0</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">playback</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">01</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">i2so3</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">playback</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">02</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">dmic</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">03</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">i2si2</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">04</span><span class="p">:</span> <span class="n">btsco</span><span class="o">-</span><span class="ow">in</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">i2s</span><span class="o">-</span><span class="n">pri</span><span class="o">-</span><span class="n">lpbk</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">06</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">i2s</span><span class="o">-</span><span class="n">hdmi</span><span class="o">-</span><span class="n">lpbk</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">6</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">hdmio</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">7</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">playback</span> <span class="mi">1</span>
<span class="mi">00</span><span class="o">-</span><span class="mi">08</span><span class="p">:</span> <span class="n">soc</span><span class="o">-</span><span class="n">hdmii</span> <span class="n">snd</span><span class="o">-</span><span class="n">soc</span><span class="o">-</span><span class="n">dummy</span><span class="o">-</span><span class="n">dai</span><span class="o">-</span><span class="mi">8</span> <span class="p">:</span>  <span class="p">:</span> <span class="n">capture</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only SL1620 has an onboard DMIC. SL1640 and SL1680 show an entry for <code class="docutils literal notranslate"><span class="pre">soc-dmic</span></code>,
but there is no physical hardware on these modules.</p>
</div>
</section>
<section id="video-sinks">
<h5>Video Sinks<a class="headerlink" href="#video-sinks" title="Permalink to this heading"></a></h5>
<p>Gstreamer on Astra Machina supports three video sinks. The main video sink is the <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code> which uses
the wayland protocol and compositor to display the video output. Astra Machina also supports the DRM KMS
sink which displays video frames directly to a Linux DRM device using the <code class="docutils literal notranslate"><span class="pre">kmssink</span></code>. The <code class="docutils literal notranslate"><span class="pre">xvimagesink</span></code>
is supported when Astra Machina is running an image with the X11 based display server.</p>
<section id="wayland-sink">
<h6>Wayland Sink<a class="headerlink" href="#wayland-sink" title="Permalink to this heading"></a></h6>
<p>Many of the following examples use the Wayland video sink to create a window and
render the decoded frames (see <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/waylandsink/index.html?gi-language=c#waylandsink">GStreamer documentation</a> for more details)</p>
<p>When using the Wayland sink, please make sure to set the
following variables in your environment. These variables may need to be
set when running commands from the serial console or a remote shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">XDG_RUNTIME_DIR</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">WAYLAND_DISPLAY</span><span class="o">=</span><span class="n">wayland</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">XDG_RUNTIME_DIR</span></code> variable specifies the directory which contains the
Wayland socket belonging to the user. The <code class="docutils literal notranslate"><span class="pre">WAYLAND_DISPLAY</span></code> variable
specifies which Wayland compositor to connect to.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Wayland sink window can be moved using a mouse. On dual display configurations the
window can be moved to either display. This feature was added in v1.1.0.</p>
</div>
</section>
<section id="kms-sink">
<h6>KMS Sink<a class="headerlink" href="#kms-sink" title="Permalink to this heading"></a></h6>
<p>The KMS sink supports displaying video without the need to run a windowing system like Wayland, since it can interface
directly with Linux DRM devices. (see <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/kms/index.html?gi-language=c">GStreamer documentation</a> for more details)</p>
<p>Before using <code class="docutils literal notranslate"><span class="pre">kmssink</span></code> be sure to disable the Wayland service if it is running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">weston</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<p>You will also need to identify the plane id for the main plane and provide this id to the <code class="docutils literal notranslate"><span class="pre">kmssink</span></code> element. You can identify the plane id using the <code class="docutils literal notranslate"><span class="pre">modetest</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">modetest</span> <span class="o">-</span><span class="n">M</span> <span class="n">synaptics</span>
</pre></div>
</div>
<p>Identify the plane id of the plane which supports <code class="docutils literal notranslate"><span class="pre">formats:</span> <span class="pre">NV12</span> <span class="pre">NV21</span> <span class="pre">UYVY</span> <span class="pre">VYUY</span> <span class="pre">YUYV</span> <span class="pre">YVYU</span></code>.</p>
<figure class="align-default" id="id21">
<img alt="../_images/modetest-ouput.png" src="../_images/modetest-ouput.png" />
<figcaption>
<p><span class="caption-text">Example of <code class="docutils literal notranslate"><span class="pre">modetest</span></code> output of the planes section on SL1680.</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="xvimagesink">
<h6>XvImageSink<a class="headerlink" href="#xvimagesink" title="Permalink to this heading"></a></h6>
<p>The XvImage sink supports displaying video using the X11 backend. In the following examples, replacing <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code> with
<code class="docutils literal notranslate"><span class="pre">xvimagesink</span></code> will allow the example to run on X (see <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/xvimagesink/index.html?gi-language=c">GStreamer documentation</a> for more details).</p>
</section>
</section>
</section>
<section id="audio-playback">
<h4>Audio Playback<a class="headerlink" href="#audio-playback" title="Permalink to this heading"></a></h4>
<p>Playing audio files involves reading and parsing the encoded audio data,
decoding the data, and outputting it to the audio sink. Some data
formats and audio sinks may also need to convert and resample the data
before sending it to the audio sink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=audio_file ! parser ! decoder ! [ convert ] ! [ resample ] ! audiosink
</pre></div>
</div>
<p>This example plays an MP3 file using the speakers of the attached HDMI
device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=audio_file.mp3 ! mpegaudioparse ! avdec_mp3 ! audioconvert ! audioresample ! alsasink device=hw:0,7
</pre></div>
</div>
</section>
<section id="video-playback">
<h4>Video Playback<a class="headerlink" href="#video-playback" title="Permalink to this heading"></a></h4>
<p>Playing a video file involves reading the file, demuxing a video stream,
parsing the encoded data, and decoding the data using the video decoder.
Finally, the decoded frames our output to the video sink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=video_file ! demux ! queue ! parser ! decoder ! videosink
</pre></div>
</div>
<p>The following example plays the main video stream of an MP4 file and
displays the video using Wayland.</p>
<p>An example of a H265 encoded video file on SL1640 / SL1680:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h265parse ! v4l2h265dec ! waylandsink fullscreen=true
</pre></div>
</div>
<p>An example of a H265 encoded video file on SL1640 / SL1680 using <code class="docutils literal notranslate"><span class="pre">xvimagesink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h265parse ! v4l2h265dec ! xvimagesink
</pre></div>
</div>
<p>An example of a H265 encoded video file on SL1620:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h265parse ! avdec_h265 ! waylandsink fullscreen=true
</pre></div>
</div>
<p>A similar example, but with a file using AV1 encoding on SL1640 / SL1680:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! av1parse ! v4l2av1dec ! waylandsink fullscreen=true
</pre></div>
</div>
<p>An example of a H265 encoded video file on SL1640 / SL1680 using kmssink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h265parse ! v4l2h265dec ! kmssink driver-name=synaptics plane-id=31
</pre></div>
</div>
</section>
<section id="audio-video-file-playback">
<h4>Audio / Video File Playback<a class="headerlink" href="#audio-video-file-playback" title="Permalink to this heading"></a></h4>
<p>Playing a file which contains both audio and video streams requires
creating a pipeline which parses and decodes both streams:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=video_file ! demux.video ! queue ! parser ! decoder ! videosink \
    demux.audio ! queue ! parser ! decoder ! [ convert ] ! [ resample ] ! audiosink
</pre></div>
</div>
<p>Play an MP4 file on SL1640 / SL1680 with a H265 encoded video stream and an AAC encoded
audio stream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4  ! qtdemux name=demux \
    demux.video_0 ! queue ! h265parse ! v4l2h265dec ! queue ! waylandsink fullscreen=true \
    demux.audio_0 ! queue ! aacparse ! fdkaacdec ! audioconvert ! alsasink device=hw:0,7
</pre></div>
</div>
<p>Play an MP4 file on SL1620 with a H265 encoded video stream and an AAC encoded
audio stream:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=little.mp4  ! qtdemux name=demux  \
    demux.video_0 ! queue ! h265parse ! avdec_h265 ! queue ! waylandsink fullscreen=true \
    demux.audio_0 ! queue ! aacparse ! fdkaacdec ! audioconvert ! alsasink device=hw:0,1
</pre></div>
</div>
<p>Play an MP4 file on SL1640 / SL1680 with a H265 encoded video stream and an AAC encoded
audio stream with <code class="docutils literal notranslate"><span class="pre">xvimagesink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=test_file.mp4  ! qtdemux name=demux \
    demux.video_0 ! queue ! h265parse ! v4l2h265dec ! queue ! xvimagesink \
    demux.audio_0 ! queue ! aacparse ! fdkaacdec ! audioconvert ! alsasink device=hw:0,7
</pre></div>
</div>
<p>Play an MP4 file on SL1620 with a H265 encoded video stream and an AAC encoded
audio stream with <code class="docutils literal notranslate"><span class="pre">xvimagesink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=little.mp4  ! qtdemux name=demux  \
    demux.video_0 ! queue ! h265parse ! avdec_h265 ! queue ! xvimagesink \
    demux.audio_0 ! queue ! aacparse ! fdkaacdec ! audioconvert ! alsasink device=hw:0,1
</pre></div>
</div>
</section>
<section id="recording">
<h4>Recording<a class="headerlink" href="#recording" title="Permalink to this heading"></a></h4>
<section id="audio-recording">
<h5>Audio Recording<a class="headerlink" href="#audio-recording" title="Permalink to this heading"></a></h5>
<p>Recording audio involves reading data from a capture device like a
microphone, converting, encoding, and multiplexing the data before
writing it to an output file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 alsasrc device=device ! [audio capabilities] ! queue ! convert ! encode ! mux ! filesink location=output file
</pre></div>
</div>
<p>The following example records audio from the ALSA capture device 1,0 (a USB microphone). It
then converts the raw data into a format which can encoded into the Vorbis
codec by the encoder. Once the data is encoded, it is then multiplexed into an Ogg
container and written to the file /tmp/alsasrc.ogg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 alsasrc device=hw:1,0 ! queue ! audioconvert ! vorbisenc ! oggmux ! filesink location=/tmp/alsasrc.ogg
</pre></div>
</div>
<p>SL1620’s core module has a built-in microphone (DMIC) which is typically enumerated as hw:0,3. This command records from the build-in mic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 alsasrc device=hw:0,3 ! audio/x-raw,format=S32LE,rate=48000,channels=2 ! queue \
    ! audioconvert ! vorbisenc ! oggmux ! filesink location=/tmp/vorbis_audio.ogg
</pre></div>
</div>
</section>
</section>
<section id="cameras">
<h4>Cameras<a class="headerlink" href="#cameras" title="Permalink to this heading"></a></h4>
<p>Astra Machina supports USB (UVC) and image sensor cameras using the V4L2 driver stack.
This stack can be used with Gstreamer to construct pipelines using a camera.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Image sensor cameras are only supported on SL1680 using SL1680’s ISP.</p>
</div>
<p>To display video captured from a camera to output it to the video sink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/videoX ! &quot;video data,framerate,format,width,height&quot; ! video sink
</pre></div>
</div>
<p>The following example reads captured data from the V4L2 device
/dev/video2 and applies the capabilities filter before sending the
output to the wayland sink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video2 ! &quot;video/x-raw,framerate=30/1,format=YUY2,width=640,height=480&quot; ! waylandsink fullscreen=true
</pre></div>
</div>
<section id="image-sensor-cameras">
<h5>Image Sensor Cameras<a class="headerlink" href="#image-sensor-cameras" title="Permalink to this heading"></a></h5>
<p>SL1680 includes an integrated ISP and supports connecting image sensor camera modules using the MIPI-CSI connectors. Gstreamer can use these
cameras using the V4L2 interface. The ISP supports 3 output paths, the main path supports outputing 4K resolution (if the sensor supports 4K), and the Secondary Paths
support 2K resolution. Each path has it’s own video device file in /dev.</p>
<p>To display video from the ISP’s Main Path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video0 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink
</pre></div>
</div>
<p>To display video from the ISP’s Secondary Path 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video1 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink
</pre></div>
</div>
<p>To display video from the ISP’s Secondary Path 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video2 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink
</pre></div>
</div>
<p>The device file number may vary depending on your configuration. You can use the <code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span></code> command to find which device files are associated with each of the
ISP paths.</p>
<figure class="align-default" id="id22">
<a class="reference internal image-reference" href="../_images/isp-path-devices.png"><img alt="../_images/isp-path-devices.png" src="../_images/isp-path-devices.png" style="width: 629.25px; height: 490.5px;" /></a>
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span> <span class="pre">--list-devices</span></code> output with the ISP Path devices highlighted</span><a class="headerlink" href="#id22" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>An additional video device is created to support Bayer RGB capture. This is the 4th video instance which advertises itself as only supporting Bayer RGB.
The other 3 video ports support NV12 / RGB only.</p>
<section id="multi-stream-support">
<h6>Multi Stream Support<a class="headerlink" href="#multi-stream-support" title="Permalink to this heading"></a></h6>
<p>SL1680 supports up to three video streams to be enabled simultaneously (excluding the Bayer RGB video port - vvcam-video.0.3). Up to three different GStreamer pipelines can be
run at the same time to validate this feature. From the GStreamer command list below, any combination of up to 3 paths — Main, Self Path 1, and Self Path 2 can be run simultaneously.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video0 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink

gst-launch-1.0 v4l2src device=/dev/video1 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink

gst-launch-1.0 v4l2src device=/dev/video2 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although multiple streams may appear as independent devices, all streams originate from a single instance. Once all streams are playing, any change
made to an existing stream is treated as a new change. Hence, ensure that all sessions are closed one by one before starting the next set of multi
or single streaming.</p>
</div>
</section>
<section id="dual-sensor-support">
<h6>Dual Sensor Support<a class="headerlink" href="#dual-sensor-support" title="Permalink to this heading"></a></h6>
<p>Sl1680 supports dual sensor configuration with the OV5647 sensor module. Dual sensor support required enabling the <code class="docutils literal notranslate"><span class="pre">dolphin-bothcsi-without-expander.dtbo</span></code>
overlay. (See <a class="reference internal" href="../subject/updating_isp_sensor_configuration.html"><span class="doc">Updating the ISP Sensor Configuration</span></a>). Once the two sensors are connected and the overlay is enabled, <code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span></code> will display a total of eight
<code class="docutils literal notranslate"><span class="pre">vvcam-video</span></code> devices. Three NV12 / RGB devices plus one Bayer RGB device per sensor.</p>
<figure class="align-default" id="id23">
<a class="reference internal image-reference" href="../_images/dual-sensor-isp-path-devices.png"><img alt="../_images/dual-sensor-isp-path-devices.png" src="../_images/dual-sensor-isp-path-devices.png" style="width: 666.0px; height: 705.75px;" /></a>
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span> <span class="pre">--list-devices</span></code> output with the dual sensor ISP Path devices highlighted</span><a class="headerlink" href="#id23" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Similar to multi stream support, multiple Gstreamer pipelines can be used with both sensors simultaniously.</p>
<p>For example, these commands will display video from the main path of the sensor connected to CSI0 and video from the main path of the sensor connected to CSI1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video3 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)30/1&#39; ! waylandsink

gst-launch-1.0 v4l2src device=/dev/video7 ! &#39;video/x-raw, format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)30/1&#39; ! waylandsink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>IMX258 and IMX415 sensors are not supported with the dual sensor configuration on Astra Machina boards. Both sensors
require a GPIO expander whereas CSI1 is incompatible with the GPIO expander.</p>
</div>
</section>
<section id="mmu-support">
<h6>MMU Support<a class="headerlink" href="#mmu-support" title="Permalink to this heading"></a></h6>
<p>Currently V4l2 ISP supports MMU for NV12 formats in MP and SP2 path only. For RGB888 and Bayer RGB format, MMU support is not enabled yet.
SP1 path doesn’t have MMU support due to HW limitation. By default, MMU support is enabled for NV12 format for MP / SP2 paths, otherwise
the MMU is automatically disabled if it is not supported. Users are not required to add any extra control commands for the MMU for the
default behavior.</p>
<p>The below table provides the default behavior whether MMU enable or disable depending upon the Camera Path and selected output format.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Path</p></th>
<th class="head"><p>Format (NV12)</p></th>
<th class="head"><p>Format (BGB888)</p></th>
<th class="head"><p>Format (Bayer RGB)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MP</p></td>
<td><p>Enabled</p></td>
<td><p>Disabled</p></td>
<td><p>Disabled</p></td>
</tr>
<tr class="row-odd"><td><p>SP1</p></td>
<td><p>Disabled</p></td>
<td><p>Disabled</p></td>
<td><p>Disabled</p></td>
</tr>
<tr class="row-even"><td><p>SP2</p></td>
<td><p>Enabled</p></td>
<td><p>Disabled</p></td>
<td><p>Disabled</p></td>
</tr>
</tbody>
</table>
<p>To explicitly disable MMU support while using NV12 format, add the extra-controls option to the Gstreamer pipeline.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video2  extra-controls=&quot;c,mmu_enable=0&quot; ! &#39;video/x-raw, \
    format=(string)NV12, width=(int)640, height=(int)480, framerate=(fraction)60/1&#39; ! waylandsink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">filesink</span></code>, the user needs to disable the MMU for paths where the MMU is enabled by default. MMU mode
requires the stride value be correctlt aligned. Unfortunately, Gstreamers filesink element ignores this value. The only
workaround is for the user to disable MMU for paths where the MMU is enabled by default.</p>
</div>
</section>
</section>
<section id="rtsp-cameras">
<h5>RTSP Cameras<a class="headerlink" href="#rtsp-cameras" title="Permalink to this heading"></a></h5>
<p>Astra Machina supports RTSP cameras using the Gstreamer RTSP plugin.</p>
<p>This example will receive a H.264 encoded camera stream and display it on SL1640 and SL1680 using hardware decoding. The rtspsrc
element connects to the camera over the network and sets the latency to 2000 milliseconds. The latency parameter along with the rtpjitterbuffer element will buffer the stream
to minimize network jitter. The rtph264depay element will depayload the H.264 stream. It’s wait-for-keyframe option will wait for a keyframe before outputing
the stream to ensure synchoronization. Then the H.264 stream is parsed and decoded using the h264parse and v4l2h264dec elements. The decoded video is then
displayed on the screen using the wayland sink:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream&quot; latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! \
    video/x-h264, width=1920, height=1080 ! h264parse ! v4l2h264dec ! videoscale ! video/x-raw,width=1920,height=1080 ! waylandsink
</pre></div>
</div>
<p>This example uses software decoding and works on SL1620, SL1640, and SL1680:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream&quot; latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! \
    video/x-h264, width=1920, height=1080 ! h264parse ! avdec_h264 ! videoscale ! video/x-raw,width=1920,height=1080 ! waylandsink
</pre></div>
</div>
<p>Multiple RTSP streams can be displayed simultaneously. This example will decode and display 4 1080p RTSP streams using the glvideomixer element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 glvideomixer name=comp \
    sink_0::alpha=1 sink_0::xpos=0 sink_0::ypos=0 sink_0::width=960 sink_0::height=540 \
    sink_1::alpha=1 sink_1::xpos=960 sink_1::ypos=0 sink_1::width=960 sink_1::height=540 \
    sink_2::alpha=1 sink_2::xpos=0 sink_2::ypos=540 sink_2::width=960 sink_2::height=540 \
    sink_3::alpha=1 sink_3::xpos=960 sink_3::ypos=540 sink_3::width=960 sink_3::height=540 \
    ! queue2 ! videoconvert ! &quot;video/x-raw, width=(int)1920, height=(int)1080, interlace-mode=(string)progressive, pixel-aspect-ratio=(fraction)1/1&quot; ! waylandsink \
    rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream1&quot; latency=2000  ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080 !  h264parse ! v4l2h264dec ! comp.sink_0 \
    rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream2&quot; latency=2000  ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080 !  h264parse ! v4l2h264dec ! comp.sink_1 \
    rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream3&quot; latency=2000  ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080 !  h264parse ! v4l2h264dec ! comp.sink_2 \
    rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream4&quot; latency=2000  ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080 !  h264parse ! v4l2h264dec ! comp.sink_3
</pre></div>
</div>
</section>
</section>
<section id="hdmi-rx">
<h4>HDMI-RX<a class="headerlink" href="#hdmi-rx" title="Permalink to this heading"></a></h4>
<p>SL1680 supports HDMI input streams from external devices (HDMI-RX) using the micro HDMI port on core module. Gstreamer can use the V4L2 interface to process and display
the video and audio streams received from the external HDMI device.</p>
<figure class="align-default" id="id24">
<img alt="../_images/sl1680-hdmi-rx.png" src="../_images/sl1680-hdmi-rx.png" />
<figcaption>
<p><span class="caption-text">SL1680 with the HDMI-RX micro HDMI port outlined in red.</span><a class="headerlink" href="#id24" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>HDMI-RX supports the following video formats typical of PC video sources and V4L2 video sources.</p>
<section id="supported-formats">
<h5>Supported Formats<a class="headerlink" href="#supported-formats" title="Permalink to this heading"></a></h5>
<section id="typical-pc-video-formats">
<h6>Typical PC Video Formats<a class="headerlink" href="#typical-pc-video-formats" title="Permalink to this heading"></a></h6>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Bits per Channel</p></th>
<th class="head"><p>Resolution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RGB</p></td>
<td><p>8, 10, 12 bits</p></td>
<td><p>4K60</p></td>
</tr>
<tr class="row-odd"><td><p>YUV422</p></td>
<td><p>8, 10, 12 bits</p></td>
<td><p>4K60</p></td>
</tr>
<tr class="row-even"><td><p>YUV444</p></td>
<td><p>8, 10, 12 bits</p></td>
<td><p>4K60</p></td>
</tr>
</tbody>
</table>
</section>
<section id="v4l2-video-formats">
<h6>V4L2 Video Formats<a class="headerlink" href="#v4l2-video-formats" title="Permalink to this heading"></a></h6>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Resolution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NV12</p></td>
<td><p>4K60</p></td>
</tr>
<tr class="row-odd"><td><p>UYVY</p></td>
<td><p>4K60</p></td>
</tr>
</tbody>
</table>
</section>
<section id="audio-formats">
<h6>Audio Formats<a class="headerlink" href="#audio-formats" title="Permalink to this heading"></a></h6>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Channels</p></th>
<th class="head"><p>Sample Rate</p></th>
<th class="head"><p>Bit Depth</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p>48kHz</p></td>
<td><p>32 bit</p></td>
</tr>
</tbody>
</table>
<p>The V4L2 device file number may vary depending on your configuration. You can use the <code class="docutils literal notranslate"><span class="pre">v4l2-ctl</span></code> command to find which device files are associated the HDMI-RX device.</p>
<figure class="align-default" id="id25">
<a class="reference internal image-reference" href="../_images/hdmi-rx-device.png"><img alt="../_images/hdmi-rx-device.png" src="../_images/hdmi-rx-device.png" style="width: 546.0px; height: 476.25px;" /></a>
<figcaption>
<p><span class="caption-text">V4L2 HDMI-RX video device file</span><a class="headerlink" href="#id25" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Use the <code class="docutils literal notranslate"><span class="pre">arecord</span></code> command to determine which ALSA capture device is associated with HDMI-RX.</p>
<figure class="align-default" id="id26">
<img alt="../_images/hdmi-rx-audio-capture-device.png" src="../_images/hdmi-rx-audio-capture-device.png" />
<figcaption>
<p><span class="caption-text">ALSA HDMI-RX audio capture device</span><a class="headerlink" href="#id26" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Use the <code class="docutils literal notranslate"><span class="pre">aplay</span></code> command to determine which ALSA playback device to use to play the captured audio. The following examples will use the speakers associated with the HDMI sink.</p>
<figure class="align-default" id="id27">
<img alt="../_images/sl1680-hdmi-output-device.png" src="../_images/sl1680-hdmi-output-device.png" />
<figcaption>
<p><span class="caption-text">HDMI audio output device</span><a class="headerlink" href="#id27" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This example displays a 2K30 stream from an external HDMI device using <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video6 ! video/x-raw,width=1920,height=1080,fps=30,format=NV12 ! waylandsink fullscreen=true
</pre></div>
</div>
<p>This example displays a 4K30 stream from an external HDMI device using <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video6 ! video/x-raw,width=3840,height=2160,fps=30,format=NV12 ! waylandsink fullscreen=true
</pre></div>
</div>
<p>This example displays a 4K30 stream from an external HDMI device using <code class="docutils literal notranslate"><span class="pre">kmssink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video6 ! video/x-raw,width=3840,height=2160,fps=30,format=NV12 !  kmssink driver-name=synaptics plane-id=31
</pre></div>
</div>
<p>This example displays a 4K30 stream with text overylay using <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video6 ! video/x-raw,width=3840,height=2160,fps=30,format=NV12 ! textoverlay text=”Sample Text” ! clockoverlay ! waylandsink fullscreen=true
</pre></div>
</div>
<p>This example starts a 2K30 stream using <code class="docutils literal notranslate"><span class="pre">waylandsink</span></code>, then creates a 48K, S32_LE, 2 Channel audio pipeline. The audio will be played on the speakers of the HDMI sink device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video6 ! video/x-raw,width=1920,height=1080,fps=30,format=NV12 ! waylandsink fullscreen=true &amp;
gst-launch-1.0 alsasrc device=hw:0,8 ! queue ! audio/x-raw,format=S32LE,rate=48000,channnels=2 ! alsasink device=hw:0,7 sync=false
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FPS is set by the source device and should be configured on the source before starting the pipeline.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">kmssink</span></code> does not support 4K60 output.</p>
</div>
</section>
</section>
</section>
<section id="gstreamer-playbin-plugin">
<h4>Gstreamer Playbin Plugin<a class="headerlink" href="#gstreamer-playbin-plugin" title="Permalink to this heading"></a></h4>
<p>Astra Machina contains the Gstreamer playbin plugin. This plugin can
automatically determine what type of pipeline to construct based on
automatic file type recognition (see <a class="reference external" href="https://gstreamer.freedesktop.org/documentation/playback/playbin.html?gi-language=c">Gstreamer documentation</a>). This simplifies pipeline creation.</p>
<p>Playbin will autodetect the media file located at the specified uri, and create a
pipeline for it. It will then display the video on the video sink and
render the audio on the audio sink. The video-sink and audio-sink
parameters are optional. If the parameters are not included, default video and
audio sinks will be used instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gst</span><span class="o">-</span><span class="n">launch</span><span class="o">-</span><span class="mf">1.0</span> <span class="n">playbin</span> <span class="n">uri</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span> <span class="n">video</span><span class="o">-</span><span class="n">sink</span><span class="o">=</span><span class="s2">&quot;video sink&quot;</span> <span class="n">audio</span><span class="o">-</span><span class="n">sink</span><span class="o">=</span><span class="s2">&quot;audio sink&quot;</span>
</pre></div>
</div>
<p>Using playbin the example in <a class="reference internal" href="#audio-sinks"><span class="std std-ref">Audio Sinks</span></a> can be reduced to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gst</span><span class="o">-</span><span class="n">launch</span><span class="o">-</span><span class="mf">1.0</span> <span class="n">playbin</span> <span class="n">uri</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span> <span class="n">video</span><span class="o">-</span><span class="n">sink</span><span class="o">=</span><span class="s2">&quot;waylandsink fullscreen=true&quot;</span> <span class="n">audio</span><span class="o">-</span><span class="n">sink</span><span class="o">=</span><span class="s2">&quot;alsasink device=hw:0,7&quot;</span>
</pre></div>
</div>
</section>
<section id="gstreamer-synap-plugin">
<h4>GStreamer SyNAP Plugin<a class="headerlink" href="#gstreamer-synap-plugin" title="Permalink to this heading"></a></h4>
<p>Astra Machina provides the Synaptics Gstreamer Plugins for AI (gstsynap) which allow adding ML processing to Gstreamer pipelines.
These plugins use the SyNAP framework to interface with the hardware accelerators to improve the performance
of ML processing. For information on SyNAP see <a class="reference internal" href="#synap"><span class="std std-ref">Machine Learning with SyNAP</span></a> below.</p>
<p>The Synaptics Gstreamer Plugins for AI consist of two plugins. The gstsynapinfer plugin, which uses SyNAP to handle AI inferencing
and the gstsynapoverlay plugin which outputs the results from gstsynapinfer and overlays then on top of the source data.</p>
<p>The gstsynapinfer plugin can operate it two modes. The first mode outputs structured data which is then used by gstsynapoverlay. This
supports common use cases such as drawing bounding boxes or overlaying text without having to write additional code. Here are several
examples using gstsynapinfer to do the inferencing and gstsynapoverlay overlaying the results. These examples show inferencing running on
a local file and an external USB camera.</p>
<p>Example of Object Detection with YOLOv8 (USB Camera Source):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/videoX ! video/x-raw,framerate=30/1,format=YUY2,width=640,height=480 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay label=/usr/share/synap/models/object_detection/coco/info.json \
    ! videoconvert ! waylandsink t_data. ! queue ! videoconvert ! videoscale ! video/x-raw,width=640,height=384,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/coco/model/yolov8s-640x384/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Object Detection with YOLOv8 (Video):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=video_file.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h264parse ! avdec_h264 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay label=/usr/share/synap/models/object_detection/coco/info.json ! \
    videoconvert ! waylandsink t_data. ! queue ! videoconvert ! videoscale ! video/x-raw,width=640,height=384,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/coco/model/yolov8s-640x384/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Object Detection with YOLOv8 (RTSP Stream):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream&quot; latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! \
    video/x-h264, width=1920, height=1080 ! h264parse ! avdec_h264 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay label=/usr/share/synap/models/object_detection/coco/info.json ! \
    videoconvert ! waylandsink t_data. ! queue ! videoconvert ! videoscale ! video/x-raw,width=640,height=384,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/coco/model/yolov8s-640x384/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Face Detection with YOLOv5 (USB Camera Source):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/videoX ! video/x-raw,framerate=30/1,format=YUY2,width=640,height=480 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay ! videoconvert ! waylandsink t_data. ! queue ! videoconvert ! \
    videoscale ! video/x-raw,width=480,height=352,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/face/model/yolov5s_face_640x480_onnx_mq/model.synap mode=detector \
    frameinterval=3 ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Face Detection with YOLOv5 (RTSP Stream):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream&quot; latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! \
    video/x-h264, width=1920, height=1080 ! h264parse ! avdec_h264 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay ! videoconvert ! waylandsink t_data. ! queue ! videoconvert ! \
    videoscale ! video/x-raw,width=480,height=352,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/face/model/yolov5s_face_640x480_onnx_mq/model.synap mode=detector \
    frameinterval=3 ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Pose Estimation with YOLOv8 (USB Camera Source):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/videoX ! video/x-raw,framerate=30/1,format=YUY2,width=640,height=480 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay ! videoconvert ! waylandsink t_data. ! queue ! videoconvert \
    ! videoscale ! video/x-raw,width=640,height=352,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/body_pose/model/yolov8s-pose/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Pose Estimation with YOLOv8 (Video):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=fitness.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h264parse ! avdec_h264 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay ! videoconvert ! waylandsink t_data. ! queue ! videoconvert ! \
    videoscale ! video/x-raw,width=640,height=352,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/body_pose/model/yolov8s-pose/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<p>Example of Pose Estimation with YOLOv8 (RTSP Stream):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 rtspsrc location=&quot;rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream&quot; latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! \
    video/x-h264, width=1920, height=1080 ! h264parse ! avdec_h264 ! videoconvert ! \
    tee name=t_data t_data. ! queue ! synapoverlay name=overlay ! videoconvert ! waylandsink t_data. ! queue ! videoconvert ! \
    videoscale ! video/x-raw,width=640,height=352,format=RGB  ! \
    synapinfer model=/usr/share/synap/models/object_detection/body_pose/model/yolov8s-pose/model.synap mode=detector frameinterval=3 \
    ! overlay.inference_sink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Replace /dev/videoX with the device file associated with your external USB camera.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above examples use software decoding to decode video files and RTSP streams. SL1640 and SL1680 also support
hardware decoding which can be enabled by changing the avdec_h264 element to v4l2h264dec.</p>
</div>
<p>In gstsynapinfer’s second mode, inference results are output as a JSON string. This allows an application to handle the overlay directly
or do additional processing on the results.</p>
<p>We provide a <a class="reference external" href="https://github.com/synaptics-astra/application-gstreamer-plugins-syna/tree/v1.6.0/tests/examples/gst-ai">sample application</a>
which makes use of gstsynapinfer’s second mode. The app plays a video while simultaneously performing image classification on the video frames,
and then overlaying labels of the results onto the video. A prebuilt version of the application is included in the Astra system image.</p>
<p>Run the example application using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gst</span><span class="o">-</span><span class="n">ai</span> <span class="o">--</span><span class="n">appmode</span><span class="o">=</span><span class="n">IC</span> <span class="o">--</span><span class="nb">input</span><span class="o">=</span><span class="n">test_file</span><span class="o">.</span><span class="n">mp4</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">screen</span> <span class="o">--</span><span class="n">paramfile</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">gst</span><span class="o">-</span><span class="n">ai</span><span class="o">/</span><span class="n">ic</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The gst-ai program uses a JSON parameter file to set additional configuration options. These options include decode mode, model, model meta-data,
count, confidence threshold, and post processing mode. The Astra Machina image provides a default JSON file for image classification at
/usr/share/gst-ai/ic.json. The supported decode modes (decmode) are <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> and <code class="docutils literal notranslate"><span class="pre">v4l2</span></code>. When set to <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> the gst-ai program will use the
<a class="reference external" href="https://ffmpeg.org/">ffmpeg library</a> to perform decoding of the video stream in software. When <code class="docutils literal notranslate"><span class="pre">v4l2</span></code> is set then gst-ai will use the V4L2 APIs
to perform decoding of the video stream using hardware acceleration.</p>
<p>In release v1.6 image classification can also be run using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc location=Animals.mp4 ! qtdemux name=demux demux.video_0 ! queue ! h264parse ! v4l2h264dec ! tee name=t_data t_data. ! queue \
    ! synavideoconvertscale ! video/x-raw,width=224,height=224,format=RGB ! \
    synapinfer model=/usr/share/synap/models/image_classification/imagenet/model/mobilenet_v2_1.0_224_quant/model.synap mode=classifier frameinterval=3 \
    ! overlay.inference_sink t_data. ! queue ! synavideoconvertscale ! video/x-raw,format=BGRA ! \
    synapoverlay name=overlay label=/usr/share/synap/models/image_classification/imagenet/info.json ! waylandsink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SL1620 requires decmode to be set to ffmpeg since it does not support V4L2 decoding.</p>
</div>
<section id="super-resolution">
<h5>Super Resolution<a class="headerlink" href="#super-resolution" title="Permalink to this heading"></a></h5>
<p>Astra Machina SL1680 provides several Super Resolution models can be used to upscale video. SL1680 has models based on QDEO and FAST.
The models are located in <code class="docutils literal notranslate"><span class="pre">/usr/share/synap/models/image_processing/super_resolution/model</span></code>.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td rowspan="4"><p>QDEO</p></td>
<td><p>sr_qdeo_y_uv_640x360_1920x1080</p></td>
</tr>
<tr class="row-even"><td><p>sr_qdeo_y_uv_960x540_3840x2160</p></td>
</tr>
<tr class="row-odd"><td><p>sr_qdeo_y_uv_1280x720_3840x2160</p></td>
</tr>
<tr class="row-even"><td><p>sr_qdeo_y_uv_1920x1080_3840x2160</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>FAST</p></td>
<td><p>sr_fast_y_uv_960x540_3840x2160</p></td>
</tr>
<tr class="row-even"><td><p>sr_fast_y_uv_1280x720_3840x2160</p></td>
</tr>
<tr class="row-odd"><td><p>sr_fast_y_uv_1920x1080_3840x2160</p></td>
</tr>
</tbody>
</table>
<p>The following examples show how to upscale video using gstreamer and the Super Resolution models.</p>
<section id="qdeo">
<h6>QDEO<a class="headerlink" href="#qdeo" title="Permalink to this heading"></a></h6>
<p>sr_qdeo_y_uv_640x360_1920x1080:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video8 ! video/x-raw,framerate=30/1,format=NV12,width=640,height=360 !\
    synapimageproc model=sr_qdeo_y_uv_640x360_1920x1080/model.synap ! waylandsink
</pre></div>
</div>
<p>sr_qdeo_y_uv_1280x720_3840x2160:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video8 ! video/x-raw,framerate=30/1,format=NV12,width=1280,height=720 !\
    synapimageproc model=sr_qdeo_y_uv_1280x720_3840x2160/model.synap ! waylandsink
</pre></div>
</div>
<p>sr_qdeo_y_uv_1920x1080_3840x2160:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video8 ! video/x-raw,framerate=30/1,format=NV12,width=1920,height=1080 !\
    synapimageproc model=sr_qdeo_y_uv_1920x1080_3840x2160/model.synap ! waylandsink
</pre></div>
</div>
</section>
<section id="fast">
<h6>FAST<a class="headerlink" href="#fast" title="Permalink to this heading"></a></h6>
<p>sr_fast_y_uv_1280x720_3840x2160:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video8 ! video/x-raw,framerate=30/1,format=NV12,width=1280,height=720 !\
    synapimageproc model=sr_fast_y_uv_1280x720_3840x2160/model.synap ! waylandsink
</pre></div>
</div>
<p>sr_fast_y_uv_1920x1080_3840x2160:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video8 ! video/x-raw,framerate=30/1,format=NV12,width=1920,height=1080 !\
    synapimageproc model=sr_fast_y_uv_1920x1080_3840x2160/model.synap !  waylandsink
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using an ISP camera, be sure to add <code class="docutils literal notranslate"><span class="pre">extra-controls=&quot;c,mmu_enable=0&quot;</span></code> to disable MMU.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 v4l2src device=/dev/video0 extra-controls=&quot;c,mmu_enable=0&quot; ! &#39;video/x-raw, format=(string)NV12, \
    width=(int)1920, height=(int)1080, framerate=(fraction)30/1&#39; ! \
    synapimageproc model=sr_fast_y_uv_1920x1080_3840x2160/model.synap ! waylandsink
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the UI is 2K. When upscaling 4K content to 4K you will need to set the UI to be 4K. Move the file
<code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d/syna_drm.conf</span></code> out of <code class="docutils literal notranslate"><span class="pre">/etc/modprobe.d</span></code> to prevent it from setting the UI resolution.</p>
</div>
</section>
</section>
</section>
</section>
<section id="multimedia-demo-applications">
<h3>Multimedia Demo Applications<a class="headerlink" href="#multimedia-demo-applications" title="Permalink to this heading"></a></h3>
<p>We also provide two <a class="reference external" href="https://github.com/synaptics-astra/application-videosdk/tree/v1.6.0/">demo QT applications</a> which demonstate the
Multimedia and AI capabilities of Astra Machina. The Syna Video Player app demonstates decoding and playing up to four video streams. The Syna AI
Player app demonstrates the AI capabilities of Astra Machina by performing object detection, face detection, and pose estimation examples.</p>
<p>The apps require the following environment variable to be set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">XDG_RUNTIME_DIR</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0</span>
<span class="n">export</span> <span class="n">WESTON_DISABLE_GBM_MODIFIERS</span><span class="o">=</span><span class="n">true</span>
<span class="n">export</span> <span class="n">WAYLAND_DISPLAY</span><span class="o">=</span><span class="n">wayland</span><span class="o">-</span><span class="mi">1</span>
<span class="n">export</span> <span class="n">QT_QPA_PLATFORM</span><span class="o">=</span><span class="n">wayland</span>
</pre></div>
</div>
<section id="multimedia-demo-customization">
<span id="qml-customization"></span><h4>Multimedia Demo Customization<a class="headerlink" href="#multimedia-demo-customization" title="Permalink to this heading"></a></h4>
<p>Both applications use <a class="reference external" href="https://doc.qt.io/qt-6/qmlreference.html">QML</a> files for their configuration. This allows users to customize the applications.
Customizations include modifying what videos are used in the application. Since no sample video files are preinstalled on the Astra Machina image,
users will need to add their own video files to the application’s QML files. The default QML files are preinstalled in /home/root/demos/qmls.</p>
</section>
<section id="syna-video-player">
<h4>Syna Video Player<a class="headerlink" href="#syna-video-player" title="Permalink to this heading"></a></h4>
<p>The Syna Video Player application demonstrates Astra Machina’s ability to play and decode videos. It supports playing a single video, or playing up to four
videos in a grid.</p>
<figure class="align-default" id="id28">
<img alt="../_images/sl1680-syna-video-player.jpg" src="../_images/sl1680-syna-video-player.jpg" />
<figcaption>
<p><span class="caption-text">The main screen of Syna Video Player</span><a class="headerlink" href="#id28" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Run the Syna Video Player:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1680</span><span class="p">:</span><span class="o">~</span><span class="c1"># syna-video-player --mach sl1680 --mode ffmpeg</span>
</pre></div>
</div>
<p>The Syna Video Player expects two paramaters, the machine type and the mode. The machine type is the version of Astra Machina which the application is running on.
The valid options are <code class="docutils literal notranslate"><span class="pre">sl1620</span></code>, <code class="docutils literal notranslate"><span class="pre">sl1640</span></code> and <code class="docutils literal notranslate"><span class="pre">sl1680</span></code>. The mode specifies which mode of decoding should be used. The options are <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> and <code class="docutils literal notranslate"><span class="pre">v4l2</span></code>.
When set to <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> the Syna Video Player application will use the <a class="reference external" href="https://ffmpeg.org/">ffmpeg library</a> to perform decoding of the video stream in software.
When <code class="docutils literal notranslate"><span class="pre">v4l2</span></code> is set then Syna Video Player will use the V4L2 APIs to perform decoding of the video stream using hardware acceleration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SL1620 requires mode to be set to ffmpeg since it does not support V4L2 decoding.</p>
</div>
<p>The information on the video files is defined in the QML files in /home/root/demos/qmls/. Please update the video names and path in these files so that Syna Video Player
can locate the videos installed on your system. The video information is set in the file <code class="docutils literal notranslate"><span class="pre">&lt;mach&gt;-&lt;mode&gt;.qml</span></code>. For example, to update the video files on SL1680 in ffmpeg mode,
modify <code class="docutils literal notranslate"><span class="pre">/home/root/demos/qmls/sl1680-ffmpeg.qml</span></code>.</p>
</section>
<section id="syna-ai-player">
<h4>Syna AI Player<a class="headerlink" href="#syna-ai-player" title="Permalink to this heading"></a></h4>
<p>The Syna AI Player application uses the above gstreamer pipelines to show object detection, face detection, and pose estimation. It also supports Multi AI view which
does object detection, face detection, and pose estimation simultaniously while playing a video.</p>
<figure class="align-default" id="id29">
<img alt="../_images/syna-ai-player.jpg" src="../_images/syna-ai-player.jpg" />
<figcaption>
<p><span class="caption-text">The main screen of Syna AI Player</span><a class="headerlink" href="#id29" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Run the Syna AI Player:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1680</span><span class="p">:</span><span class="o">~</span><span class="c1"># syna-ai-player --mach sl1680</span>
</pre></div>
</div>
<p>The Syna AI Player expects the machine type parameter. The machine type is the version of Astra Machina which the app is running on.
The valid options are <code class="docutils literal notranslate"><span class="pre">sl1620</span></code>, <code class="docutils literal notranslate"><span class="pre">sl1640</span></code> and <code class="docutils literal notranslate"><span class="pre">sl1680</span></code>.</p>
<p>The information on the video file used in the Multi View window is defined in the QML files in /home/root/demos/qmls/. Please update the video name and path in this file so that Syna AI Player
can locate the video installed on your system. The video information is set in the file <code class="docutils literal notranslate"><span class="pre">/home/root/demos/qmls/panels/MultiAi.qml</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multi AI mode by default, requires 3 seperate cameras. One of which needs to be a USB 3.0 device.</p>
</div>
<section id="multiview-customization">
<h5>Multiview Customization<a class="headerlink" href="#multiview-customization" title="Permalink to this heading"></a></h5>
<p>Modifying the QML files also allows running custom Gstreamer pipelines. Changing the command paramters in the GridItem section will change the pipelines displayed in the MulitAI panels.
The following example will display 4 RTSP streams running 3 separate AI models:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GridLayout</span> <span class="p">{</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">ma</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.9</span>
    <span class="n">anchors</span><span class="o">.</span><span class="n">top</span><span class="p">:</span> <span class="n">header</span><span class="o">.</span><span class="n">bottom</span>
    <span class="n">anchors</span><span class="o">.</span><span class="n">centerIn</span><span class="p">:</span> <span class="n">parent</span>

    <span class="n">GridItem</span> <span class="p">{</span>
        <span class="nb">type</span><span class="p">:</span> <span class="mi">2</span>
        <span class="n">image</span><span class="p">:</span> <span class="s2">&quot;qrc:/res/images/multiicon.png&quot;</span>
        <span class="n">title</span><span class="p">:</span>  <span class="n">qsTr</span><span class="p">(</span><span class="s2">&quot;Multi-AI&quot;</span><span class="p">)</span>
        <span class="n">command1</span><span class="p">:</span> <span class="s2">&quot;rtspsrc location=</span><span class="se">\&quot;</span><span class="s2">rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream1</span><span class="se">\&quot;</span><span class="s2"> latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080  ! h264parse ! v4l2h264dec ! tee name=t_data t_data. ! queue ! v4l2convert extra-controls=</span><span class="se">\&quot;</span><span class="s2">c,io_mmu_capture_buffer=0,io_mmu_output_buffer=0</span><span class="se">\&quot;</span><span class="s2"> ! video/x-raw, width=640, height=384, format=NV12  ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=RGB ! gldownload ! synapinfer model=/usr/share/synap/models/object_detection/coco/model/yolov8s-640x384/model.synap mode=detector frameinterval=3 ! overlay.inference_sink t_data. ! queue ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=BGRA ! gldownload ! synapoverlay name=overlay label=/usr/share/synap/models/object_detection/coco/info.json ! waylandsink&quot;</span>
        <span class="n">command2</span><span class="p">:</span> <span class="s2">&quot;rtspsrc location=</span><span class="se">\&quot;</span><span class="s2">rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream2</span><span class="se">\&quot;</span><span class="s2"> latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080  ! h264parse ! v4l2h264dec ! tee name=t_data t_data. ! queue ! v4l2convert extra-controls=</span><span class="se">\&quot;</span><span class="s2">c,io_mmu_capture_buffer=0,io_mmu_output_buffer=0</span><span class="se">\&quot;</span><span class="s2"> ! video/x-raw, width=480, height=352, format=NV12 ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=RGB ! gldownload ! synapinfer model=/usr/share/synap/models/object_detection/face/model/yolov5s_face_640x480_onnx_mq/model.synap mode=detector frameinterval=3 ! overlay.inference_sink t_data. ! queue ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=BGRA ! gldownload ! synapoverlay name=overlay ! waylandsink&quot;</span>
        <span class="n">command3</span><span class="p">:</span> <span class="s2">&quot;rtspsrc location=</span><span class="se">\&quot;</span><span class="s2">rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream3</span><span class="se">\&quot;</span><span class="s2"> latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080  ! h264parse ! v4l2h264dec ! tee name=t_data t_data. ! queue ! v4l2convert extra-controls=</span><span class="se">\&quot;</span><span class="s2">c,io_mmu_capture_buffer=0,io_mmu_output_buffer=0</span><span class="se">\&quot;</span><span class="s2"> ! video/x-raw, width=640, height=352, format=NV12 ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=RGB ! gldownload ! synapinfer model=/usr/share/synap/models/object_detection/body_pose/model/yolov8s-pose/model.synap mode=detector frameinterval=3 ! overlay.inference_sink t_data. ! queue ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=BGRA ! gldownload ! synapoverlay name=overlay ! waylandsink&quot;</span>
        <span class="n">command4</span><span class="p">:</span> <span class="s2">&quot;rtspsrc location=</span><span class="se">\&quot;</span><span class="s2">rtsp://&lt;user&gt;:&lt;password&gt;@&lt;ip&gt;/stream4</span><span class="se">\&quot;</span><span class="s2"> latency=2000 ! rtpjitterbuffer ! rtph264depay wait-for-keyframe=true ! video/x-h264, width=1920, height=1080  ! h264parse ! v4l2h264dec ! tee name=t_data t_data. ! queue ! v4l2convert extra-controls=</span><span class="se">\&quot;</span><span class="s2">c,io_mmu_capture_buffer=0,io_mmu_output_buffer=0</span><span class="se">\&quot;</span><span class="s2"> ! video/x-raw, width=640, height=384, format=NV12 ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=RGB ! gldownload ! synapinfer model=/usr/share/synap/models/object_detection/coco/model/yolov8s-640x384/model.synap mode=detector frameinterval=3 ! overlay.inference_sink t_data. ! queue ! glupload ! glcolorconvert ! video/x-raw\(memory:GLMemory\), format=BGRA ! gldownload ! synapoverlay name=overlay label=/usr/share/synap/models/object_detection/coco/info.json ! waylandsink&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only SL1680 support Multiview.</p>
</div>
</section>
</section>
</section>
</section>
<section id="machine-learning-with-synap">
<span id="synap"></span><h2>Machine Learning with SyNAP<a class="headerlink" href="#machine-learning-with-synap" title="Permalink to this heading"></a></h2>
<p>Astra Machina uses the SyNAP framework for execution of neural networks using the platform’s hardware accelerators.
This framework allows users to run programs which take advantage of the Neural Processing Unit (NPU)
and Graphics Processing Unit (GPU) to accelerate the execution of neural networks. (see the <a class="reference external" href="https://synaptics-synap.github.io/doc/v/3.0.0/">SyNAP documentation</a> for more details.)</p>
</section>
<section id="connectivity">
<h2>Connectivity<a class="headerlink" href="#connectivity" title="Permalink to this heading"></a></h2>
<p>Bluetooth and Wi-Fi are supported on Astra Machina through on-board chip
solutions and external hardware. The following table lists the various
on-board chips and external solutions:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>SL Processor</p></th>
<th class="head"><p>Wireless Device</p></th>
<th class="head"><p>Physical Interface</p>
<p>(M.2 PCIe / M.2 SDIO)</p>
</th>
<th class="head"><p>Software Information</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SL1620</p></td>
<td><p>SYNA 43711</p></td>
<td><p>M.2 SDIO</p></td>
<td><ul class="simple">
<li><p>wpa_supplicant v2.11</p></li>
<li><p>WIFI driver version: v101.10.478</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>SL1640</p></td>
<td><p>SYNA 43752</p></td>
<td><p>M.2 PCIe</p></td>
<td><ul class="simple">
<li><p>wpa_supplicant v2.11</p></li>
<li><p>WIFI driver version: v101.10.478</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>SL1680</p></td>
<td><p>SYNA 43752</p></td>
<td><p>M.2 PCIe</p></td>
<td><ul class="simple">
<li><p>wpa_supplicant v2.11</p></li>
<li><p>WIFI driver version: v101.10.478</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The Synaptics Astra Linux BSP contains all of the drivers and firmware required to use the 43xxx modules with both PCIe and SDIO interfaces.
Wireless network management is handled by the WPA Supplicant daemon which key negotiation with a WPA Authenticator. It supports WEP, WPA, WPA2, and WPA3
authentication standards. ( See <a class="reference external" href="https://wiki.archlinux.org/title/wpa_supplicant">wpa_supplicant</a> for more details)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SL1640 and SL1680 can be configured to use the SYNA 43711 module with SDIO.
See <a class="reference internal" href="../subject/enable_sdio_wifi.html"><span class="doc">Enabling SDIO WiFi for SL640 and SL680</span></a></p>
</div>
<section id="setting-up-wifi-with-wpa-supplicant">
<h3>Setting up Wifi with WPA Supplicant<a class="headerlink" href="#setting-up-wifi-with-wpa-supplicant" title="Permalink to this heading"></a></h3>
<p>The following section describes how to setup Wifi on Astra Machina using WPA Supplicant.</p>
<section id="generate-the-wpa-pre-shared-key">
<h4>Generate the WPA Pre-shared Key<a class="headerlink" href="#generate-the-wpa-pre-shared-key" title="Permalink to this heading"></a></h4>
<p>Generating a pre-shared key from a passphrase avoids having to store the passphrase in the WPA Supplicant config file.</p>
<p>From the shell, use the wpa_passphrase command line tool to generate a WPA pre-shared key from a passphrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1680</span><span class="p">:</span><span class="o">^</span><span class="c1"># wpa_passphrase network_name 12345678</span>
<span class="n">network</span><span class="o">=</span><span class="p">{</span>
    <span class="n">ssid</span><span class="o">=</span><span class="s2">&quot;network_name&quot;</span>
    <span class="n">psk</span><span class="o">=</span><span class="mi">5</span><span class="n">ba83b0673ea069dafe5d5f1af8216771c13be6ad6f11dac9dc0e90b0c604981</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="bringing-up-the-wlan-interface">
<h4>Bringing up the WLAN Interface<a class="headerlink" href="#bringing-up-the-wlan-interface" title="Permalink to this heading"></a></h4>
<p>Use ifconfig to instruct the kernel to bring up the wlan interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">wlan0</span> <span class="n">up</span>
</pre></div>
</div>
</section>
<section id="creating-the-wpa-supplicant-configuration-file">
<h4>Creating the WPA Supplicant Configuration File<a class="headerlink" href="#creating-the-wpa-supplicant-configuration-file" title="Permalink to this heading"></a></h4>
<p>WPA Supplicant uses a config file to configure the Wifi connection. This configuration file is located in /etc/wpa_supplicant.</p>
<p>Create the /etc/wpa_supplicant directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">wpa_supplicant</span>
</pre></div>
</div>
<p>Create the file /etc/wpa_supplicant/wpa_supplicant-wlan0.conf with options for your Wifi Network.</p>
<p>Contents of an example wpa_supplicant-wlan0.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl_interface</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">wpa_supplicant</span>
<span class="n">ctrl_interface_group</span><span class="o">=</span><span class="mi">0</span>
<span class="n">update_config</span><span class="o">=</span><span class="mi">1</span>

<span class="n">network</span><span class="o">=</span><span class="p">{</span>
    <span class="n">ssid</span><span class="o">=</span><span class="s2">&quot;network_name&quot;</span>
    <span class="n">psk</span><span class="o">=</span><span class="mi">5</span><span class="n">ba83b0673ea069dafe5d5f1af8216771c13be6ad6f11dac9dc0e90b0c604981</span>
    <span class="n">key_mgmt</span><span class="o">=</span><span class="n">WPA</span><span class="o">-</span><span class="n">PSK</span>
    <span class="n">scan_ssid</span><span class="o">=</span><span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="configure-systemd-networkd">
<h4>Configure systemd-networkd<a class="headerlink" href="#configure-systemd-networkd" title="Permalink to this heading"></a></h4>
<p>The wlan interface needs to be enabled in the systemd-networkd system daemon configuration.</p>
<p>Create the new file /etc/systemd/network/25-wlan.network with the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Match</span><span class="p">]</span>
<span class="n">Name</span><span class="o">=</span><span class="n">wlan0</span>

<span class="p">[</span><span class="n">Network</span><span class="p">]</span>
<span class="n">DHCP</span><span class="o">=</span><span class="n">ipv4</span>
</pre></div>
</div>
</section>
<section id="enable-wifi-services">
<h4>Enable Wifi Services<a class="headerlink" href="#enable-wifi-services" title="Permalink to this heading"></a></h4>
<p>The network daemons need to be restarted to load the new configuration.</p>
<p>Restart network daemons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">wpa_supplicant</span><span class="nd">@wlan0</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<p>Enable wpa_supplicant on boot up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">wpa_supplicant</span><span class="nd">@wlan0</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</section>
</section>
<section id="setup-the-access-point-ap-mode-with-hostapd">
<h3>Setup the Access Point (AP mode) with hostapd<a class="headerlink" href="#setup-the-access-point-ap-mode-with-hostapd" title="Permalink to this heading"></a></h3>
<p>The Wifi interface can also be configured to act as an access point using <a class="reference external" href="https://w1.fi/hostapd/">hostapd</a>.
Additional packages may need to be installed to support hostapd and iptables. Please see the Astra Yocto User Guide
for instructions on how to add the hostapd and iptables packages to your image.</p>
<section id="configure-networking-to-use-hostapd">
<h4>Configure Networking to use hostapd<a class="headerlink" href="#configure-networking-to-use-hostapd" title="Permalink to this heading"></a></h4>
<p>To configure the wlan device to use hostapd add the following entries to the /etc/network/interfaces file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">wlan0</span>
<span class="n">iface</span> <span class="n">wlan0</span> <span class="n">inet</span> <span class="n">static</span>
    <span class="n">address</span> <span class="mf">192.168.10.1</span>
    <span class="n">netmask</span> <span class="mf">255.255.255.0</span>
    <span class="n">post</span><span class="o">-</span><span class="n">up</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">hostapd</span>
    <span class="n">pre</span><span class="o">-</span><span class="n">down</span> <span class="n">systemctl</span> <span class="n">stop</span> <span class="n">hostapd</span>
</pre></div>
</div>
</section>
<section id="id3">
<h4>Configure systemd-networkd<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h4>
<p>The wlan interface needs to be enabled in the systemd-networkd system daemon configuration.</p>
<p>Create the new file /etc/systemd/network/10-wlan0.network with the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Match</span><span class="p">]</span>
<span class="n">Name</span><span class="o">=</span><span class="n">wlan0</span>

<span class="p">[</span><span class="n">Network</span><span class="p">]</span>
<span class="n">Address</span><span class="o">=</span><span class="mf">192.168.10.1</span><span class="o">/</span><span class="mi">24</span>
<span class="n">DHCPServer</span><span class="o">=</span><span class="n">yes</span>

<span class="p">[</span><span class="n">DHCPServer</span><span class="p">]</span>
<span class="n">EmitDNS</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
</section>
<section id="configure-hostapd">
<h4>Configure hostapd<a class="headerlink" href="#configure-hostapd" title="Permalink to this heading"></a></h4>
<p>Create the file /etc/hostapd.conf with the ip, ssid, and passphrase of the Wifi network you are creating.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">own_ip_addr</span><span class="o">=</span><span class="mf">192.168.10.1</span>
<span class="n">ssid</span><span class="o">=</span><span class="n">yocto640</span>
<span class="n">wpa</span><span class="o">=</span><span class="mi">2</span>
<span class="n">wpa_passphrase</span><span class="o">=</span><span class="mi">1234567890</span>
</pre></div>
</div>
</section>
<section id="configuring-ip-forwarding-firewall-rules">
<h4>Configuring IP Forwarding Firewall Rules<a class="headerlink" href="#configuring-ip-forwarding-firewall-rules" title="Permalink to this heading"></a></h4>
<p>IP Forwarding and NAT need to be configured to forward traffic coming from be new wireless network.</p>
<p>The following is an example of using iptables to forward traffic over the ethernet inferface using NAT. Add the new rules to /etc/iptables/iptables.rules
so that they can be loaded at boot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>iptables –F
iptables -F INPUT
iptables -F OUTPUT
iptables -F FORWARD
iptables -t nat -F
iptables -t mangle -F
iptables -A INPUT -j ACCEPT
iptables -A OUTPUT -j ACCEPT
iptables -A FORWARD -j ACCEPT
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables-save &gt; /etc/iptables/iptables.rules
</pre></div>
</div>
<p>IP Forwarding is enabled by setting the following entries in /etc/sysctl.d/ip_forward.conf:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Run the following command to enable ip forwarding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">ip_forward</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be sure to connect an ethernet cable to Astra Machina so that traffic can be forwarded to the ethernet interface.</p>
</div>
</section>
<section id="enabling-services">
<h4>Enabling Services<a class="headerlink" href="#enabling-services" title="Permalink to this heading"></a></h4>
<p>Start hostapd and iptables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">start</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">iptables</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
<p>Enable hostapd and iptables on boot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">enable</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">iptables</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</section>
<section id="verify-wlan0-interface-configuration">
<h4>Verify wlan0 Interface Configuration<a class="headerlink" href="#verify-wlan0-interface-configuration" title="Permalink to this heading"></a></h4>
<p>After enabling hostapd and iptables, use the <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command to verify that <code class="docutils literal notranslate"><span class="pre">wlan0</span></code> is enabled.</p>
<figure class="align-default">
<img alt="../_images/hostapd-wlan0.png" src="../_images/hostapd-wlan0.png" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">wlan0</span></code> does not appear in the <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> output then you may need to run the <code class="docutils literal notranslate"><span class="pre">sync</span></code> command and reboot. This will make
sure that the configuration changes were applied.</p>
</div>
</section>
<section id="disabling-services">
<h4>Disabling Services<a class="headerlink" href="#disabling-services" title="Permalink to this heading"></a></h4>
<p>Use the following commands to stop using the Wifi interface as an access point and disable hostapd:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">stop</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">stop</span> <span class="n">iptables</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">disable</span> <span class="n">hostapd</span><span class="o">.</span><span class="n">service</span>
<span class="n">systemctl</span> <span class="n">disable</span> <span class="n">iptables</span><span class="o">.</span><span class="n">service</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">network</span><span class="o">/</span><span class="mi">10</span><span class="o">-</span><span class="n">wlan0</span><span class="o">.</span><span class="n">network</span>
</pre></div>
</div>
</section>
</section>
<section id="performing-throughput-tests">
<h3>Performing throughput tests<a class="headerlink" href="#performing-throughput-tests" title="Permalink to this heading"></a></h3>
<p>Astra Machina provides the <a class="reference external" href="https://iperf.fr/">iPerf2</a> tool for measuring network throughput. iPerf is a widely used tool for network
performance measurement and tuning. It uses a client / server model to measure the throughput between devices on a network. It supports
both TCP and UDP protocols. Full documentation on iPerf2 can be found on the <a class="reference external" href="https://iperf.fr/iperf-doc.php#doc">iPerf website</a>.</p>
<section id="tcp-traffic">
<h4>TCP Traffic<a class="headerlink" href="#tcp-traffic" title="Permalink to this heading"></a></h4>
<p>The following example runs a TCP throughput test between the client and server using the default options.
In this example the server has the IP address <code class="docutils literal notranslate"><span class="pre">10.5.0.3</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The server must be started before the client.</p>
</div>
<p>Client Side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -c 10.5.0.3
</pre></div>
</div>
<figure class="align-default" id="id30">
<img alt="../_images/iperf-tcp-client.png" src="../_images/iperf-tcp-client.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> client running on SL1620 in TCP mode</span><a class="headerlink" href="#id30" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Server side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -s
</pre></div>
</div>
<figure class="align-default" id="id31">
<img alt="../_images/iperf-tcp-server.png" src="../_images/iperf-tcp-server.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> server running on SL1620 in TCP mode</span><a class="headerlink" href="#id31" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="udp-traffic">
<h4>UDP Traffic<a class="headerlink" href="#udp-traffic" title="Permalink to this heading"></a></h4>
<p>The following example runs a UDP throughput test between the client and server using the default options.
In this example the server has the IP address <code class="docutils literal notranslate"><span class="pre">10.5.0.3</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The server must be started before the client.</p>
</div>
<p>Client side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -c 10.5.0.3 -u
</pre></div>
</div>
<figure class="align-default" id="id32">
<img alt="../_images/iperf-udp-client.png" src="../_images/iperf-udp-client.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> client running on SL1620 in UDP mode</span><a class="headerlink" href="#id32" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Server side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -s -u
</pre></div>
</div>
<figure class="align-default" id="id33">
<img alt="../_images/iperf-udp-server.png" src="../_images/iperf-udp-server.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> server running on SL1620 in UDP mode</span><a class="headerlink" href="#id33" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="common-iperf-options">
<h4>Common iPerf Options<a class="headerlink" href="#common-iperf-options" title="Permalink to this heading"></a></h4>
<p>The following options are commonly used with the <cite>iperf</cite> command to customize its behavior:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-i</span></code>: Interval</dt><dd><p>Specifies the interval (in seconds) between periodic bandwidth reports. For example, <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">1</span></code> will print a report every second.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-l</span></code>: Length</dt><dd><p>Sets the length of the buffer to read or write. For example, <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">128K</span></code> sets the buffer length to 128 kilobytes.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-b</span></code>: Bandwidth</dt><dd><p>Specifies the target bandwidth for UDP tests. For example, <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">10M</span></code> sets the target bandwidth to 10 megabits per second.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-w</span></code>: Window size</dt><dd><p>Sets the TCP window size. For example, <code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">256K</span></code> sets the TCP window size to 256 kilobytes.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-t</span></code>: Time</dt><dd><p>Specifies the time (in seconds) to transmit for. For example, <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">60</span></code> will run the test for 60 seconds.</p>
</dd>
</dl>
</li>
</ul>
<p>This example is of a TCP throughput test with a 10 second interval between reports, a 128 kilobyte buffer, a 1000 megabit per
second target bandwidth, a 256 kilobyte TCP window size, and a 60 second test duration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -c 10.5.0.3 -i 10 -l 128K -b 1000M -w 256K -t 60
</pre></div>
</div>
<figure class="align-default" id="id34">
<img alt="../_images/iperf-tcp-client-custom-options.png" src="../_images/iperf-tcp-client-custom-options.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> client running on SL1620 with custom options</span><a class="headerlink" href="#id34" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Server side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -s -i 10 -l 128K -b 1000M -w 256K -t 60
</pre></div>
</div>
<figure class="align-default" id="id35">
<img alt="../_images/iperf-tcp-server-custom-options.png" src="../_images/iperf-tcp-server-custom-options.png" />
<figcaption>
<p><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">iperf</span></code> server running on SL1620 with custom options</span><a class="headerlink" href="#id35" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="using-the-bluetooth-a2dp-source-role">
<h3>Using the Bluetooth A2DP source role<a class="headerlink" href="#using-the-bluetooth-a2dp-source-role" title="Permalink to this heading"></a></h3>
<section id="searching-and-connecting-to-the-headset">
<h4>Searching and connecting to the headset<a class="headerlink" href="#searching-and-connecting-to-the-headset" title="Permalink to this heading"></a></h4>
<p>First you need to enter the Bluetooth console using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1640</span><span class="p">:</span><span class="o">~</span><span class="c1"># bluetoothctl</span>
<span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Once in the Bluetooth console you can run various commands to control the Bluetooth stack described in the following
paragraphs.</p>
<p>You can show information about the Bluetooth controller on the board with the <code class="docutils literal notranslate"><span class="pre">show</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># show</span>
<span class="n">Controller</span> <span class="n">C0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span> <span class="p">(</span><span class="n">public</span><span class="p">)</span>
        <span class="n">Name</span><span class="p">:</span> <span class="n">sl1640</span>
        <span class="n">Alias</span><span class="p">:</span> <span class="n">sl1640</span>
        <span class="n">Class</span><span class="p">:</span> <span class="mh">0x00000000</span>
        <span class="n">Powered</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">Discoverable</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">DiscoverableTimeout</span><span class="p">:</span> <span class="mh">0x000000b4</span>
        <span class="n">Pairable</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Audio</span> <span class="n">Source</span>              <span class="p">(</span><span class="mi">0000110</span><span class="n">a</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Generic</span> <span class="n">Attribute</span> <span class="n">Profile</span> <span class="p">(</span><span class="mi">00001801</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Generic</span> <span class="n">Access</span> <span class="n">Profile</span>    <span class="p">(</span><span class="mi">00001800</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">PnP</span> <span class="n">Information</span>           <span class="p">(</span><span class="mi">00001200</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">A</span><span class="o">/</span><span class="n">V</span> <span class="n">Remote</span> <span class="n">Control</span> <span class="n">Target</span> <span class="p">(</span><span class="mi">0000110</span><span class="n">c</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">A</span><span class="o">/</span><span class="n">V</span> <span class="n">Remote</span> <span class="n">Control</span>        <span class="p">(</span><span class="mf">0000110e-0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Device</span> <span class="n">Information</span>        <span class="p">(</span><span class="mi">0000180</span><span class="n">a</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">Modalias</span><span class="p">:</span> <span class="n">usb</span><span class="p">:</span><span class="n">v1D6Bp0246d0541</span>
        <span class="n">Discovering</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">Roles</span><span class="p">:</span> <span class="n">central</span>
        <span class="n">Roles</span><span class="p">:</span> <span class="n">peripheral</span>
<span class="n">Advertising</span> <span class="n">Features</span><span class="p">:</span>
        <span class="n">ActiveInstances</span><span class="p">:</span> <span class="mh">0x00</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">SupportedInstances</span><span class="p">:</span> <span class="mh">0x06</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">SupportedIncludes</span><span class="p">:</span> <span class="n">tx</span><span class="o">-</span><span class="n">power</span>
        <span class="n">SupportedIncludes</span><span class="p">:</span> <span class="n">appearance</span>
        <span class="n">SupportedIncludes</span><span class="p">:</span> <span class="n">local</span><span class="o">-</span><span class="n">name</span>
        <span class="n">SupportedSecondaryChannels</span><span class="p">:</span> <span class="mi">1</span><span class="n">M</span>
        <span class="n">SupportedSecondaryChannels</span><span class="p">:</span> <span class="mi">2</span><span class="n">M</span>
        <span class="n">SupportedSecondaryChannels</span><span class="p">:</span> <span class="n">Coded</span>
</pre></div>
</div>
<p>In order to connect to the headset you first need to power on the bluetooth controller:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># power on</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Controller</span> <span class="n">C0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span> <span class="n">Class</span><span class="p">:</span> <span class="mh">0x00080000</span>
<span class="n">Changing</span> <span class="n">power</span> <span class="n">on</span> <span class="n">succeeded</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Controller</span> <span class="n">C0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span> <span class="n">Powered</span><span class="p">:</span> <span class="n">yes</span>
</pre></div>
</div>
<p>You then need to set the controller in pairable mode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># pairable on</span>
<span class="n">Changing</span> <span class="n">pairable</span> <span class="n">on</span> <span class="n">succeeded</span>
</pre></div>
</div>
<p>You can then search for the headset (make sure the headset is in discoverable mode):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># scan on</span>
<span class="n">Discovery</span> <span class="n">started</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Controller</span> <span class="n">C0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span> <span class="n">Discovering</span><span class="p">:</span> <span class="n">yes</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">2</span><span class="n">D</span><span class="p">:</span><span class="mi">9</span><span class="n">A</span><span class="p">:</span><span class="n">A9</span><span class="p">:</span><span class="mi">4</span><span class="n">F</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">37</span> <span class="mi">2</span><span class="n">D</span><span class="o">-</span><span class="mi">9</span><span class="n">A</span><span class="o">-</span><span class="n">A9</span><span class="o">-</span><span class="mi">4</span><span class="n">F</span><span class="o">-</span><span class="mi">54</span><span class="o">-</span><span class="mi">37</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">4</span><span class="n">E</span><span class="p">:</span><span class="n">E7</span><span class="p">:</span><span class="n">B0</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">2</span><span class="n">A</span><span class="p">:</span><span class="mi">11</span> <span class="mi">4</span><span class="n">E</span><span class="o">-</span><span class="n">E7</span><span class="o">-</span><span class="n">B0</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="mi">2</span><span class="n">A</span><span class="o">-</span><span class="mi">11</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">7</span><span class="n">F</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="n">E9</span><span class="p">:</span><span class="n">E9</span> <span class="mi">7</span><span class="n">F</span><span class="o">-</span><span class="mi">84</span><span class="o">-</span><span class="n">A3</span><span class="o">-</span><span class="mi">29</span><span class="o">-</span><span class="n">E9</span><span class="o">-</span><span class="n">E9</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">6</span><span class="n">A</span><span class="p">:</span><span class="n">B0</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">79</span> <span class="mi">6</span><span class="n">A</span><span class="o">-</span><span class="n">B0</span><span class="o">-</span><span class="mi">95</span><span class="o">-</span><span class="mf">7E-58</span><span class="o">-</span><span class="mi">79</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">7</span><span class="n">E</span><span class="p">:</span><span class="mi">4</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span><span class="p">:</span><span class="n">C4</span><span class="p">:</span><span class="mi">3</span><span class="n">B</span><span class="p">:</span><span class="mi">6</span><span class="n">F</span> <span class="mf">7E-4</span><span class="n">D</span><span class="o">-</span><span class="mi">8</span><span class="n">F</span><span class="o">-</span><span class="n">C4</span><span class="o">-</span><span class="mi">3</span><span class="n">B</span><span class="o">-</span><span class="mi">6</span><span class="n">F</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">40</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="n">CE</span><span class="p">:</span><span class="mi">4</span><span class="n">D</span><span class="p">:</span><span class="n">F1</span><span class="p">:</span><span class="mi">8</span><span class="n">E</span> <span class="mi">40</span><span class="o">-</span><span class="mi">93</span><span class="o">-</span><span class="n">CE</span><span class="o">-</span><span class="mi">4</span><span class="n">D</span><span class="o">-</span><span class="n">F1</span><span class="o">-</span><span class="mi">8</span><span class="n">E</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">47</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="n">A3</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="n">A9</span> <span class="mi">47</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="mi">71</span><span class="o">-</span><span class="n">A3</span><span class="o">-</span><span class="mi">79</span><span class="o">-</span><span class="n">A9</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">67</span><span class="p">:</span><span class="mi">62</span><span class="p">:</span><span class="mi">9</span><span class="n">C</span><span class="p">:</span><span class="mi">4</span><span class="n">B</span><span class="p">:</span><span class="n">F9</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span> <span class="mi">67</span><span class="o">-</span><span class="mi">62</span><span class="o">-</span><span class="mi">9</span><span class="n">C</span><span class="o">-</span><span class="mi">4</span><span class="n">B</span><span class="o">-</span><span class="n">F9</span><span class="o">-</span><span class="mi">7</span><span class="n">D</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">8</span><span class="n">C</span><span class="p">:</span><span class="n">F8</span><span class="p">:</span><span class="n">C5</span><span class="p">:</span><span class="n">BD</span><span class="p">:</span><span class="mi">6</span><span class="n">F</span><span class="p">:</span><span class="mi">1</span><span class="n">D</span> <span class="n">DTKBTQ3</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">BT208</span>
</pre></div>
</div>
<p>This command returns the MAC address of all the devices that are currently discoverable. You need to identify the one
of the headset you want to pair.</p>
<p>After identifying the MAC address of the device you want to pair with, you can disable scanning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># scan off</span>
<span class="n">Discovery</span> <span class="n">stopped</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Controller</span> <span class="n">C0</span><span class="p">:</span><span class="n">F5</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="n">AA</span><span class="p">:</span><span class="mi">7</span><span class="n">D</span><span class="p">:</span><span class="mi">8</span><span class="n">F</span> <span class="n">Discovering</span><span class="p">:</span> <span class="n">no</span>
</pre></div>
</div>
<p>Once you found the headset you can pair to it by using the <code class="docutils literal notranslate"><span class="pre">pair</span></code> command with the MAC address of the headset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># pair 0A:73:76:09:55:C0</span>
<span class="n">Attempting</span> <span class="n">to</span> <span class="n">pair</span> <span class="k">with</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Connected</span><span class="p">:</span> <span class="n">yes</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Bonded</span><span class="p">:</span> <span class="n">yes</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">UUIDs</span><span class="p">:</span> <span class="mi">00001108</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">UUIDs</span><span class="p">:</span> <span class="mi">0000110</span><span class="n">b</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">UUIDs</span><span class="p">:</span> <span class="mi">0000110</span><span class="n">c</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">UUIDs</span><span class="p">:</span> <span class="mf">0000110e-0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">UUIDs</span><span class="p">:</span> <span class="mf">0000111e-0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">ServicesResolved</span><span class="p">:</span> <span class="n">yes</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Paired</span><span class="p">:</span> <span class="n">yes</span>
<span class="n">Pairing</span> <span class="n">successful</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">ServicesResolved</span><span class="p">:</span> <span class="n">no</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Connected</span><span class="p">:</span> <span class="n">no</span>
</pre></div>
</div>
<p>The next step is to mark the device as trusted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># trust 0A:73:76:09:55:C0</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Trusted</span><span class="p">:</span> <span class="n">yes</span>
<span class="n">Changing</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">trust</span> <span class="n">succeeded</span>
</pre></div>
</div>
<p>The last step is to setup the connection with the headset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bluetooth</span><span class="p">]</span><span class="c1"># connect 0A:73:76:09:55:C0</span>
<span class="n">Attempting</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">Connected</span><span class="p">:</span> <span class="n">yes</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Endpoint</span> <span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">bluez</span><span class="o">/</span><span class="n">hci0</span><span class="o">/</span><span class="n">dev_0A_73_76_09_55_C0</span><span class="o">/</span><span class="n">sep1</span>
<span class="p">[</span><span class="n">NEW</span><span class="p">]</span> <span class="n">Transport</span> <span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">bluez</span><span class="o">/</span><span class="n">hci0</span><span class="o">/</span><span class="n">dev_0A_73_76_09_55_C0</span><span class="o">/</span><span class="n">sep1</span><span class="o">/</span><span class="n">fd0</span>
<span class="n">Connection</span> <span class="n">successful</span>
<span class="p">[</span><span class="n">BT208</span><span class="p">]</span><span class="c1"># [  286.922414] input: BT208 (AVRCP) as /devices/virtual/input/input1</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Transport</span> <span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">bluez</span><span class="o">/</span><span class="n">hci0</span><span class="o">/</span><span class="n">dev_0A_73_76_09_55_C0</span><span class="o">/</span><span class="n">sep1</span><span class="o">/</span><span class="n">fd0</span> <span class="n">Volume</span><span class="p">:</span> <span class="mh">0x0060</span> <span class="p">(</span><span class="mi">96</span><span class="p">)</span>
<span class="p">[</span><span class="n">DEL</span><span class="p">]</span> <span class="n">Device</span> <span class="n">D4</span><span class="p">:</span><span class="n">D2</span><span class="p">:</span><span class="n">D6</span><span class="p">:</span><span class="mi">4</span><span class="n">F</span><span class="p">:</span><span class="mi">80</span><span class="p">:</span><span class="mi">60</span> <span class="mi">445</span><span class="n">HD_BT_60</span>
<span class="p">[</span><span class="n">CHG</span><span class="p">]</span> <span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="n">ServicesResolved</span><span class="p">:</span> <span class="n">ye</span>
<span class="p">[</span><span class="n">BT208</span><span class="p">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>If the connection was successful the console prompt will show the name of device we connected to.</p>
<p>We can now get the information about the device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">BT208</span><span class="p">]</span><span class="c1"># info</span>
<span class="n">Device</span> <span class="mi">0</span><span class="n">A</span><span class="p">:</span><span class="mi">73</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">C0</span> <span class="p">(</span><span class="n">public</span><span class="p">)</span>
        <span class="n">Name</span><span class="p">:</span> <span class="n">BT208</span>
        <span class="n">Alias</span><span class="p">:</span> <span class="n">BT208</span>
        <span class="n">Class</span><span class="p">:</span> <span class="mh">0x00240404</span>
        <span class="n">Icon</span><span class="p">:</span> <span class="n">audio</span><span class="o">-</span><span class="n">headset</span>
        <span class="n">Paired</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">Bonded</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">Trusted</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">Blocked</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">Connected</span><span class="p">:</span> <span class="n">yes</span>
        <span class="n">LegacyPairing</span><span class="p">:</span> <span class="n">no</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Headset</span>                   <span class="p">(</span><span class="mi">00001108</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Audio</span> <span class="n">Sink</span>                <span class="p">(</span><span class="mi">0000110</span><span class="n">b</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">A</span><span class="o">/</span><span class="n">V</span> <span class="n">Remote</span> <span class="n">Control</span> <span class="n">Target</span> <span class="p">(</span><span class="mi">0000110</span><span class="n">c</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">A</span><span class="o">/</span><span class="n">V</span> <span class="n">Remote</span> <span class="n">Control</span>        <span class="p">(</span><span class="mf">0000110e-0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">UUID</span><span class="p">:</span> <span class="n">Handsfree</span>                 <span class="p">(</span><span class="mf">0000111e-0000</span><span class="o">-</span><span class="mi">1000</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">00805</span><span class="n">f9b34fb</span><span class="p">)</span>
        <span class="n">RSSI</span><span class="p">:</span> <span class="o">-</span><span class="mi">69</span>
        <span class="n">TxPower</span><span class="p">:</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
<section id="playing-music-to-the-headset">
<h4>Playing music to the headset<a class="headerlink" href="#playing-music-to-the-headset" title="Permalink to this heading"></a></h4>
<p>In order to test playback you need to upload a sound file (in <code class="docutils literal notranslate"><span class="pre">.wav</span></code> format)  to the board for instance using <code class="docutils literal notranslate"><span class="pre">scp</span></code>.</p>
<p>The file can be played to the A2DP sink using the <code class="docutils literal notranslate"><span class="pre">aplay</span></code> command. The command takes as parameter the MAC address of the
headeset (in the example below <code class="docutils literal notranslate"><span class="pre">0A:73:76:09:55:C0</span></code>) and the name of wave file (in the example below
<code class="docutils literal notranslate"><span class="pre">/home/root/example.wav</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@sl1640</span><span class="p">:</span><span class="o">~</span><span class="c1"># aplay --verbose -D  bluealsa:DEV=0A:73:76:09:55:C0 -t wav /home/root/example.wav</span>
<span class="n">Playing</span> <span class="n">WAVE</span> <span class="s1">&#39;/home/root/example.wav&#39;</span> <span class="p">:</span> <span class="n">Signed</span> <span class="mi">16</span> <span class="n">bit</span> <span class="n">Little</span> <span class="n">Endian</span><span class="p">,</span> <span class="n">Rate</span> <span class="mi">48000</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">Stereo</span>
<span class="n">Plug</span> <span class="n">PCM</span><span class="p">:</span> <span class="n">BlueALSA</span> <span class="n">PCM</span><span class="p">:</span> <span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">bluealsa</span><span class="o">/</span><span class="n">hci0</span><span class="o">/</span><span class="n">dev_0A_73_76_09_55_C0</span><span class="o">/</span><span class="n">a2dpsrc</span><span class="o">/</span><span class="n">sink</span>
<span class="n">BlueALSA</span> <span class="n">BlueZ</span> <span class="n">device</span><span class="p">:</span> <span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">bluez</span><span class="o">/</span><span class="n">hci0</span><span class="o">/</span><span class="n">dev_0A_73_76_09_55_C0</span>
<span class="n">BlueALSA</span> <span class="n">Bluetooth</span> <span class="n">codec</span><span class="p">:</span> <span class="n">SBC</span>
<span class="n">Its</span> <span class="n">setup</span> <span class="ow">is</span><span class="p">:</span>
  <span class="n">stream</span>       <span class="p">:</span> <span class="n">PLAYBACK</span>
  <span class="n">access</span>       <span class="p">:</span> <span class="n">RW_INTERLEAVED</span>
  <span class="nb">format</span>       <span class="p">:</span> <span class="n">S16_LE</span>
  <span class="n">subformat</span>    <span class="p">:</span> <span class="n">STD</span>
  <span class="n">channels</span>     <span class="p">:</span> <span class="mi">2</span>
  <span class="n">rate</span>         <span class="p">:</span> <span class="mi">48000</span>
  <span class="n">exact</span> <span class="n">rate</span>   <span class="p">:</span> <span class="mi">48000</span> <span class="p">(</span><span class="mi">48000</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">msbits</span>       <span class="p">:</span> <span class="mi">16</span>
  <span class="n">buffer_size</span>  <span class="p">:</span> <span class="mi">24000</span>
  <span class="n">period_size</span>  <span class="p">:</span> <span class="mi">6000</span>
  <span class="n">period_time</span>  <span class="p">:</span> <span class="mi">125000</span>
  <span class="n">tstamp_mode</span>  <span class="p">:</span> <span class="n">NONE</span>
  <span class="n">tstamp_type</span>  <span class="p">:</span> <span class="n">GETTIMEOFDAY</span>
  <span class="n">period_step</span>  <span class="p">:</span> <span class="mi">1</span>
  <span class="n">avail_min</span>    <span class="p">:</span> <span class="mi">6000</span>
  <span class="n">period_event</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="n">start_threshold</span>  <span class="p">:</span> <span class="mi">24000</span>
  <span class="n">stop_threshold</span>   <span class="p">:</span> <span class="mi">24000</span>
  <span class="n">silence_threshold</span><span class="p">:</span> <span class="mi">0</span>
  <span class="n">silence_size</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="n">boundary</span>     <span class="p">:</span> <span class="mi">6755399441055744000</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="the-linux-boot-process">
<h2>The Linux Boot Process<a class="headerlink" href="#the-linux-boot-process" title="Permalink to this heading"></a></h2>
<p>Before the Linux Kernel begins executing on Astra Machina, low level
firmware and software initializes the hardware and prepares the system for boot.
This section provides an overview of the software components which prepare the
system for booting the Linux Kernel.</p>
<section id="software-overview">
<h3>Software Overview<a class="headerlink" href="#software-overview" title="Permalink to this heading"></a></h3>
<p>Astra Machina uses a multistage boot process. This
section gives a brief description of each component.</p>
<section id="preboot-firmware">
<h4>Preboot Firmware<a class="headerlink" href="#preboot-firmware" title="Permalink to this heading"></a></h4>
<p>The Preboot firmware is a collection of low level firmware which
initializes specific hardware components and loads the software which
runs in the Arm TrustZone environment. Once the Preboot firmware
completes, execution will be transferred to the bootloader. The Preboot
firmware is provided as binary images which are written to the boot
device.</p>
</section>
<section id="bootloader">
<span id="bootloader-overview"></span><h4>Bootloader<a class="headerlink" href="#bootloader" title="Permalink to this heading"></a></h4>
<p>Astra Machina uses the Synaptics U-Boot (SU-Boot) bootloader to do additional
hardware initialization and to boot the Linux Kernel. SU-Boot is based on the
open source U-Boot project. (<a class="reference external" href="https://docs.u-boot.org/en/latest/">U-Boot Documentation</a>)</p>
</section>
<section id="linux-kernel-and-device-tree">
<h4>Linux Kernel and Device Tree<a class="headerlink" href="#linux-kernel-and-device-tree" title="Permalink to this heading"></a></h4>
<p>Astra Machina primarily run OSes which use the Linux
Kernel. The Linux Kernel provides the environment in which applications
run and it manages resources such as CPU, memory, and devices.
Generally, the Linux Kernel will be built as part of the Yocto build
process described in the Astra Yocto User Guide.</p>
<p>The Linux Kernel uses Device Tree data structures to describe the
hardware components and their configurations on the system. The device
tree source files are in the Linux Kernel source tree under that path
<code class="docutils literal notranslate"><span class="pre">arch/arm64/boot/dts/synaptics/</span></code>. These files are maintained in the <a class="reference external" href="https://github.com/synaptics-astra/linux_5_15-overlay">Astra Linux Kernel Overlay repository</a>.
This directory also includes device tree overlays which can be used to
modify the device tree without having to recompile the entire device tree.</p>
</section>
<section id="root-file-system">
<h4>Root File System<a class="headerlink" href="#root-file-system" title="Permalink to this heading"></a></h4>
<p>The root file system (rootfs) contains all the user space binaries and
libraries needed to execute programs in the Linux OS along with system
configuration files. The prebuilt images use Yocto to build the rootfs.
Instructions on how to build and configure a rootfs using Yocto can be
found in the <a class="reference internal" href="../yocto.html"><span class="doc">Astra Yocto Linux Developer Guide</span></a>.</p>
</section>
</section>
<section id="u-boot">
<h3>U-Boot<a class="headerlink" href="#u-boot" title="Permalink to this heading"></a></h3>
<p>As mentioned above, Astra Machina uses U-Boot as its bootloader. There
are three types of U-Boot which are used with Astra Machina. In addition
to SU-Boot, there are SPI U-Boot and USB U-Boot variants which are used to
flash or recover a device.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>image type</p></th>
<th class="head"><p>image usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SPI SU-Boot</p></td>
<td><p>burn eMMC image via TFTP server or USB drive</p></td>
</tr>
<tr class="row-odd"><td><p>USB SU-Boot</p></td>
<td><p>burn eMMC image via TFTP server of USB host</p></td>
</tr>
<tr class="row-even"><td><p>SU-Boot</p></td>
<td><p>burn eMMC image via TFTP server or USB drive, Booting Linux</p></td>
</tr>
</tbody>
</table>
<p>USB SU-Boot and SPI SU-Boot are used to boot a device which does not have
an image written to the eMMC or to do a update which overwrites all of
the contents of the eMMC.</p>
<p>USB SU-Boot allows the board to receive a copy of the USB version of
SU-Boot over the USB interface. The host system runs the usb_boot tool
to transfer the USB SU-Boot image to the board and execute it. Once USB SU-Boot
is running on the board it can be used to write an image to the eMMC.</p>
<p>SPI SU-Boot is similar to USB SU-Boot except that SU-Boot runs from
SPI flash. The SPI flash may be located on the main board of Astra Machina or
it may be a located on a SPI daughter card which is plugged into the device.
Once SPI U-Boot is running on the board it can be used to write an image to the eMMC.</p>
<p><a class="reference external" href="https://github.com/synaptics-astra/boot-u-boot_2019_10/tree/v1.6.0">Synaptics U-Boot Source Code</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Release v1.6 and later use Synaptics U-Boot for eMMC, SPI, and USB versions of U-Boot.</p>
</div>
</section>
<section id="booting-from-spi-and-sd-cards">
<span id="spi-sd-boot"></span><h3>Booting from SPI and SD Cards<a class="headerlink" href="#booting-from-spi-and-sd-cards" title="Permalink to this heading"></a></h3>
<p>Astra Machina’s I/O board has a jumper labeled <code class="docutils literal notranslate"><span class="pre">SD_BOOT</span></code>. This jumper controls
whether the device boots from the eMMC or the internal SPI flash. If the jumper
is attached then the device will boot from the internal SPI flash. Remove the jumper
to boot from eMMC.</p>
<figure class="align-default" id="id36">
<img alt="../_images/sd-boot-jumper.png" src="../_images/sd-boot-jumper.png" />
<figcaption>
<p><span class="caption-text">Astra Machina Component Diagram with SD_BOOT-Boot jumper highlighted</span><a class="headerlink" href="#id36" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Astra Machina’s internal SPI flash comes preprogrammed with SPI U-Boot. When the
SD_BOOT-Boot jumper is connected the device will boot from the SD card inserted in the SD card slot.
If no SD card is inserted the SPI U-Boot will boot to the U-Boot prompt “=&gt;”. The U-Boot prompt
can be used to set variables, or flash the eMMC and internal SPI flash.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Booting from SD cards is not supported on SL1620</p>
</div>
<section id="generating-bootable-sd-card-images">
<h4>Generating Bootable SD Card Images<a class="headerlink" href="#generating-bootable-sd-card-images" title="Permalink to this heading"></a></h4>
<p>Creating a bootable SD card requires converting an existing image into a format suitable for writing
to the SD card. You can convert either prebuilt release images or an image you built yourself.
Run the <code class="docutils literal notranslate"><span class="pre">gen_sd.sh</span></code> script from within the image directory. You can find the <code class="docutils literal notranslate"><span class="pre">gen_sd.sh</span></code> script
on <a class="reference external" href="https://github.com/synaptics-astra/build/blob/v1.6.0/tools/bin/gen_sd.sh">GitHub</a>.
Click the “Download Raw File” to download the script. The script runs in a Linux environment with the
<code class="docutils literal notranslate"><span class="pre">mkfs.ext4</span></code>, <code class="docutils literal notranslate"><span class="pre">gzip</span></code>, <code class="docutils literal notranslate"><span class="pre">gdisk</span></code>, and <code class="docutils literal notranslate"><span class="pre">sgdisk</span></code> utilties installed.</p>
<figure class="align-default" id="id37">
<img alt="../_images/download_gen_sd.png" src="../_images/download_gen_sd.png" />
<figcaption>
<p><span class="caption-text">Downloading gen_sd.sh from GitHub</span><a class="headerlink" href="#id37" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id38">
<img alt="../_images/start_gen_sd.png" src="../_images/start_gen_sd.png" />
<figcaption>
<p><span class="caption-text">Running gen_sd.sh from within the prebuilt V1.0.0 eMMCimg directory</span><a class="headerlink" href="#id38" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>During the conversion <code class="docutils literal notranslate"><span class="pre">gen_sd.sh</span></code> will create the new file <code class="docutils literal notranslate"><span class="pre">SD.img</span></code>. This is the new image file which
will be written to the SD card.</p>
<figure class="align-default" id="id39">
<img alt="../_images/end_gen_sd.png" src="../_images/end_gen_sd.png" />
<figcaption>
<p><span class="caption-text">After gen_sd.sh completed</span><a class="headerlink" href="#id39" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="writing-bootable-images-to-the-sd-card">
<h4>Writing Bootable Images to the SD Card<a class="headerlink" href="#writing-bootable-images-to-the-sd-card" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">SD.img</span></code> file is written to the SD card using the <a class="reference external" href="https://etcher.balena.io/">Balena Etcher</a> tool.
Begin by downloading and installing the tool. Then run the tool and follow the steps in the UI to select the image and target device.
Finally, click the flash button to begin the process.</p>
<figure class="align-default" id="id40">
<img alt="../_images/balena_etcher.png" src="../_images/balena_etcher.png" />
<figcaption>
<p><span class="caption-text">The start screen of Balena Etcher</span><a class="headerlink" href="#id40" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id41">
<img alt="../_images/balena_etcher_flash.png" src="../_images/balena_etcher_flash.png" />
<figcaption>
<p><span class="caption-text">Balena Etcher after selecting the image file and target device</span><a class="headerlink" href="#id41" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>After the flashing process completes, the SD card will now be ready to boot Astra Machina.</p>
<figure class="align-default" id="id42">
<img alt="../_images/balena_etcher_complete.png" src="../_images/balena_etcher_complete.png" />
<figcaption>
<p><span class="caption-text">Balena Etcher after successfully flashinge image to the SD card</span><a class="headerlink" href="#id42" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="u-boot-prompt-with-su-boot">
<span id="uboot-prompt"></span><h3>U-Boot Prompt with SU-Boot<a class="headerlink" href="#u-boot-prompt-with-su-boot" title="Permalink to this heading"></a></h3>
<p>When booting from the internal eMMC or from an SD card, SU-Boot will automatically load the Linux kernel.
However, this process can be interrupted by pressing any key in the serial console during the boot process.
If U-Boot detects a keypress then it will stop at the U-Boot prompt “=&gt;”. The U-Boot prompt can be used to
set variables, or flash the eMMC and internal SPI flash. By default the timeout in which U-Boot will wait
for input is set to 0, so key presses need to be sent before U-Boot starts.</p>
</section>
</section>
<section id="updating-astra-software">
<span id="prepare-to-boot"></span><h2>Updating Astra Software<a class="headerlink" href="#updating-astra-software" title="Permalink to this heading"></a></h2>
<p>On power on, Astra Machina will read the firmware, bootloader, and the
Linux Kernel from a boot device. The most common boot device is an eMMC
device on the board. This section will discuss how to write a boot image
to the eMMC and internal SPI flash.</p>
<section id="the-astra-system-image">
<h3>The Astra System Image<a class="headerlink" href="#the-astra-system-image" title="Permalink to this heading"></a></h3>
<figure class="align-default" id="id43">
<img alt="../_images/astra_image.png" src="../_images/astra_image.png" />
<figcaption>
<p><span class="caption-text">A screenshot of the Astra image</span><a class="headerlink" href="#id43" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The “Astra System Image” is a directory containing several subimg
files and emmc_part_list, emmc_image_list, and emmc_image_list_full. The
emmc_part_list describes the GUID Partition Table (GPT) which will be
used for the eMMC. The emmc_image_list* files specify which sub image
files should be written to which partition on the eMMC.</p>
<p>Example SL1640 Partition Table:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Partition name</p></th>
<th class="head"><p>Contents</p></th>
<th class="head"><p>Can be removed</p></th>
<th class="head"><p>Accessed by</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>factory_setting</p></td>
<td><p>MAC address and other factory provisioned files, used by user space</p></td>
<td><p>No</p></td>
<td><p>Linux user space</p></td>
</tr>
<tr class="row-odd"><td><p>key_a</p></td>
<td><p>AVB keys, user keys (A copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-even"><td><p>tzk_a</p></td>
<td><p>TrustZone Kernel (A copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-odd"><td><p>key_b</p></td>
<td><p>AVB keys, user keys (B copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-even"><td><p>tzk_b</p></td>
<td><p>TrustZone Kernel (B copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-odd"><td><p>bl_a</p></td>
<td><p>OEM Boot loader (A copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-even"><td><p>bl_b</p></td>
<td><p>OEM Boot loader (B copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-odd"><td><p>boot_a</p></td>
<td><p>Linux Kernel, loaded by OEM bootloader (A copy)</p></td>
<td><p>No</p></td>
<td><p>OEM boot loader (bl_a)</p></td>
</tr>
<tr class="row-even"><td><p>boot_b</p></td>
<td><p>Linux Kernel, loaded by OEM bootloader (B copy)</p></td>
<td><p>No</p></td>
<td><p>OEM boot loader (bl_b)</p></td>
</tr>
<tr class="row-odd"><td><p>firmware_a</p></td>
<td><p>GPU / DSP / SM firmwares, loaded by early boot, required (A copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-even"><td><p>firmware_b</p></td>
<td><p>GPU / DSP / SM firmwares, loaded by early boot, required (B copy)</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-odd"><td><p>rootfs_a</p></td>
<td><p>Root file system, used by Linux, can be changed (A copy)</p></td>
<td><p>No</p></td>
<td><p>Linux (boot_a)</p></td>
</tr>
<tr class="row-even"><td><p>rootfs_b</p></td>
<td><p>Root file system, used by Linux, can be changed (B copy)</p></td>
<td><p>No</p></td>
<td><p>Linux (boot_b)</p></td>
</tr>
<tr class="row-odd"><td><p>fastlogo_a</p></td>
<td><p>Fast logo image, loaded by OEM bootloader, can be changed (A copy)</p></td>
<td><p>No</p></td>
<td><p>OEM bootloader (bl_a)</p></td>
</tr>
<tr class="row-even"><td><p>fastlogo_b</p></td>
<td><p>Fast logo image, loaded by OEM bootloader, can be changed (B copy)</p></td>
<td><p>No</p></td>
<td><p>OEM bootloader (bl_b)</p></td>
</tr>
<tr class="row-odd"><td><p>devinfo</p></td>
<td><p>Device information (such as serial number, mac address ) required</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-even"><td><p>misc</p></td>
<td><p>Boot control settings, required</p></td>
<td><p>Yes</p></td>
<td><p>Early boot (boot partition)</p></td>
</tr>
<tr class="row-odd"><td><p>home</p></td>
<td><p>Mounted in /home, can be customized</p></td>
<td><p>No</p></td>
<td><p>Linux user space</p></td>
</tr>
</tbody>
</table>
</section>
<section id="updating-software-images-using-usb">
<span id="firmware-update-usb"></span><h3>Updating Software Images using USB<a class="headerlink" href="#updating-software-images-using-usb" title="Permalink to this heading"></a></h3>
<p>Astra Machina supports updating software images using USB.</p>
<section id="setting-up-the-usb-boot-environment">
<span id="usb-boot-setup"></span><h4>Setting up the USB Boot Environment<a class="headerlink" href="#setting-up-the-usb-boot-environment" title="Permalink to this heading"></a></h4>
<p>Booting from USB requires the <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> software tool to be the installed on
a host system. Windows, Mac, and Linux hosts are supported. Windows systems
also require the Synaptics WinUSB Driver. Mac and Linux systems do not require
any additional drivers. This section covers how to configure the host system
and prepare for USB booting.</p>
<section id="hardware-setup">
<h5>Hardware Setup<a class="headerlink" href="#hardware-setup" title="Permalink to this heading"></a></h5>
<p>To run usb_boot you will also need to connect a USB cable from the host
system to the USB Type-C USB 2.0 port on Astra Machina (next to the ethernet port).</p>
<figure class="align-default" id="id44">
<img alt="../_images/usb-c.png" src="../_images/usb-c.png" />
<figcaption>
<p><span class="caption-text">Astra Machina Component Diagram with USB Type-C USB 2.0 port highlighted</span><a class="headerlink" href="#id44" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="installing-the-winusb-driver-windows-only">
<h4>Installing the WinUSB Driver (Windows Only)<a class="headerlink" href="#installing-the-winusb-driver-windows-only" title="Permalink to this heading"></a></h4>
<p>Windows requires a special USB kernel driver to communicate with
Astra Machina over USB. Please download the driver from
<a class="reference external" href="https://github.com/synaptics-astra/usb-tool">GitHub</a>. Linux and Mac hosts
can access the Astra board from user space and do not need any additional
kernel drivers.</p>
<p>After downloading and decompressing the USB Boot software package, right
click on the <code class="docutils literal notranslate"><span class="pre">SYNA_WinUSB.inf</span></code> file in the <code class="docutils literal notranslate"><span class="pre">Synaptics_WinUSB_Driver</span></code>
directory. Select “Install” from the drop down menu.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Installing the Windows driver requires an account with administative privileges. Please contact
your System Administrator if you do not have sufficient privileges. Or update using U-Boot <a class="reference internal" href="#update-with-uboot"><span class="std std-ref">Updating Images from U-Boot</span></a></p>
</div>
<figure class="align-default" id="id45">
<img alt="../_images/install_driver_win.png" src="../_images/install_driver_win.png" />
<figcaption>
<p><span class="caption-text">Install the driver</span><a class="headerlink" href="#id45" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>After installing the driver, the Astra Machina will show up in
the Windows Device Manager as the “Synaptics IoT: Tools package USB
Driver for Synaptics Processors” when operating in USB Boot mode.</p>
<figure class="align-default" id="id46">
<img alt="../_images/devices_win.png" src="../_images/devices_win.png" />
<figcaption>
<p><span class="caption-text">Devices listed by the operating system after installing the driver</span><a class="headerlink" href="#id46" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Astra Machina will not show up in the Window’s Device Manager or be seen by the tool until putting the
device into USB Boot Mode. Hold down the USB_BOOT and press the RESET button as described below.</p>
</div>
</section>
<section id="running-astra-update">
<h4>Running Astra Update<a class="headerlink" href="#running-astra-update" title="Permalink to this heading"></a></h4>
<p>Astra Update can be downloaded from <a class="reference external" href="https://github.com/synaptics-astra/usb-tool">GitHub</a>.
The tool is included in the same repository as the WinUSB driver.</p>
<dl class="simple">
<dt>Before running the tool, copy the image to the <code class="docutils literal notranslate"><span class="pre">usb-tool</span></code> directory.</dt><dd><ul class="simple">
<li><p>Pre-built eMMC images are available from the <a class="reference external" href="https://github.com/synaptics-astra/sdk/releases">Astra SDK Releases</a> page.</p></li>
<li><p>SPI images can be downloaded from the <a class="reference external" href="https://github.com/synaptics-astra/spi-u-boot/releases">SPI U-Boot Releases</a> page.</p></li>
</ul>
</dd>
<dt>To update the eMMC:</dt><dd><ol class="arabic simple">
<li><p>Place the eMMC image in the <code class="docutils literal notranslate"><span class="pre">usb-tool</span></code> directory (named <code class="docutils literal notranslate"><span class="pre">eMMCimg</span></code> for pre-built or <code class="docutils literal notranslate"><span class="pre">SYNAIMG</span></code> for custom builds).</p></li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">update_emmc</span></code> script to begin the update.</p></li>
</ol>
</dd>
<dt>To update internal SPI Flash:</dt><dd><ol class="arabic simple">
<li><p>Place the SPI image in the <code class="docutils literal notranslate"><span class="pre">usb-tool</span></code> directory (named <code class="docutils literal notranslate"><span class="pre">sl1620</span></code> / <code class="docutils literal notranslate"><span class="pre">sl1640</span></code> / <code class="docutils literal notranslate"><span class="pre">sl1680</span></code> depending on the device).</p></li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">update_spi</span></code> script to begin the update.</p></li>
</ol>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please check the release notes to confirm that you have a compatible version of <code class="docutils literal notranslate"><span class="pre">astra-update</span></code>.
<a class="reference internal" href="../release_notes/v1.6.0.html"><span class="doc">Release Notes v1.6.0</span></a></p>
</div>
<figure class="align-default" id="id47">
<img alt="../_images/usb-tool-win.png" src="../_images/usb-tool-win.png" />
<figcaption>
<p><span class="caption-text">usb-tool directory on Windows</span><a class="headerlink" href="#id47" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>After running <code class="docutils literal notranslate"><span class="pre">update_emmc.bat</span></code>, a window will open showing the status of the flash process.</p>
<figure class="align-default" id="id48">
<img alt="../_images/astra-update-emmc.png" src="../_images/astra-update-emmc.png" />
<figcaption>
<p><span class="caption-text">Output of the <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> tool on Windows</span><a class="headerlink" href="#id48" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id49">
<img alt="../_images/astra-update-spi-start.png" src="../_images/astra-update-spi-start.png" />
<figcaption>
<p><span class="caption-text">Output of the <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> tool preparing to update SPI Flash</span><a class="headerlink" href="#id49" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Once the <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> tool is running on the host system, Astra Machina will need to be placed into USB
Boot mode. To do this, press and hold the “USB_BOOT” button on the I/O board. Then press and release the
“RESET” button. Be sure to hold the “USB_BOOT” button long enough so that the board can reset and detect
that the “USB_BOOT” button is pressed. After booting into USB Boot mode, U-Boot will automatically flash
the eMMC image from the host onto Astra Machina. The board will automatically reboot when the update is complete.</p>
<figure class="align-default" id="id50">
<img alt="../_images/usb-boot-and-reset.png" src="../_images/usb-boot-and-reset.png" />
<figcaption>
<p><span class="caption-text">Astra Machina Component Diagram with USB_BOOT and RESET buttons highlighted</span><a class="headerlink" href="#id50" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id51">
<img alt="../_images/astra-update-emmc-complete.png" src="../_images/astra-update-emmc-complete.png" />
<figcaption>
<p><span class="caption-text">Output of the <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> tool after a successful update</span><a class="headerlink" href="#id51" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that the <code class="docutils literal notranslate"><span class="pre">SD_BOOT</span></code> jumper is not attached when booting from eMMC. Otherwise,
the device will boot from internal SPI flash or an SD Card. See <a class="reference internal" href="#spi-sd-boot"><span class="std std-ref">Booting from SPI and SD Cards</span></a>.</p>
</div>
<section id="running-astra-update-on-mac-os-and-linux">
<h5>Running Astra Update on Mac OS and Linux<a class="headerlink" href="#running-astra-update-on-mac-os-and-linux" title="Permalink to this heading"></a></h5>
<p>On Mac OS, right click on the usb-tool directory. From the drop down select <code class="docutils literal notranslate"><span class="pre">Services</span> <span class="pre">-&gt;</span> <span class="pre">New</span> <span class="pre">Terminal</span> <span class="pre">at</span> <span class="pre">Folder</span></code>.</p>
<figure class="align-default" id="id52">
<img alt="../_images/mac-open-terminal.png" src="../_images/mac-open-terminal.png" />
<figcaption>
<p><span class="caption-text">Opening a Terminal for <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> on Mac</span><a class="headerlink" href="#id52" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This will open a terminal inside of the selected usb_boot directory. From there run the <code class="docutils literal notranslate"><span class="pre">update_emmc.sh</span></code> script to
run the tool. You may be prompted for your password since the script internally calls sudo. The tool
requires additional permissions to interface with USB devices and access system resources.</p>
<figure class="align-default" id="id53">
<img alt="../_images/mac-run-astra-update.png" src="../_images/mac-run-astra-update.png" />
<figcaption>
<p><span class="caption-text">Output of <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> on Mac</span><a class="headerlink" href="#id53" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some versions of Mac OS may be configured to block apps from “unverified developers”. If you encounter
this error please go to System Preference -&gt; Security &amp; Privacy -&gt; General to enable executing apps from
unverified developers.</p>
</div>
<p>On Linux, right click on the usb-tool directory. From the drop down select  <code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">in</span> <span class="pre">Terminal</span></code>.</p>
<figure class="align-default" id="id54">
<img alt="../_images/linux-open-terminal.png" src="../_images/linux-open-terminal.png" />
<figcaption>
<p><span class="caption-text">Opening a Terminal for <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> on Linux</span><a class="headerlink" href="#id54" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>This will open a terminal inside of the usb-tool directory. From there run the <code class="docutils literal notranslate"><span class="pre">update_emmc.sh</span></code> script to
run the tool. You may be prompted for your password since the script internally calls sudo. The tool
requires additional permissions to interface with USB devices and access system resources.</p>
<figure class="align-default" id="id55">
<img alt="../_images/linux-run-astra-update.png" src="../_images/linux-run-astra-update.png" />
<figcaption>
<p><span class="caption-text">Output of <code class="docutils literal notranslate"><span class="pre">astra-update</span></code> on Linux</span><a class="headerlink" href="#id55" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Astra Update no longer requires a USB-TTL board or cable to run commands at the U-Boot prompt.</p>
</div>
</section>
</section>
</section>
<section id="updating-images-from-u-boot">
<span id="update-with-uboot"></span><h3>Updating Images from U-Boot<a class="headerlink" href="#updating-images-from-u-boot" title="Permalink to this heading"></a></h3>
<p>In addition to updating Astra Machina using the USB interface, you can also update directly from U-Boot. Astra
Machina contains a version of U-Boot written to the eMMC and to an internal SPI flash chip located on the core
module. Both instances of U-Boot allows doing image updates without using a USB host system. However, they do
require a USB-TTL cable to access the serial console. Images can be loaded using an external USB drive or
downloaded from a TFTP server on a local network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The version of U-Boot written to the eMMC is updated along with the system images when doing an eMMC update. The
version of U-Boot written to the internal SPI flash is independent of the eMMC image.
Please check the release notes to confirm that you have a compatible version of U-Boot installed
before updating the eMMC image. <a class="reference internal" href="../release_notes/v1.6.0.html"><span class="doc">Release Notes v1.6.0</span></a></p>
</div>
<section id="setting-up-the-u-boot-environment">
<h4>Setting up the U-Boot Environment<a class="headerlink" href="#setting-up-the-u-boot-environment" title="Permalink to this heading"></a></h4>
<p>Booting from U-Boot does not require any additional software on the host besides the software for using the
serial console as described in the <a class="reference internal" href="#setup-serial-console"><span class="std std-ref">Setting up the Serial Console</span></a> section above.</p>
<section id="id4">
<h5>Hardware Setup<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h5>
<p>To access the U-Boot prompt, you will need to connect the USB cable for the
serial port as described in the <a class="reference internal" href="#setup-serial-console"><span class="std std-ref">Setting up the Serial Console</span></a> section above.
This will allow you to see console messages during the flashing process and input commands to the U-Boot
prompt. You will also need a USB drive or Ethernet cable depending on where the eMMC or SPI image files are located.
The USB drive can be inserted into any of the 4 USB Type-A USB 3.0 ports or the USB Type-C USB 2.0 port (may require
USB Type-C to USB Type-A adaptor).</p>
<figure class="align-default" id="id56">
<img alt="../_images/usb-and-ethernet-ports.png" src="../_images/usb-and-ethernet-ports.png" />
<figcaption>
<p><span class="caption-text">Astra Machina Component Diagram with USB and Ethernet ports highlighted</span><a class="headerlink" href="#id56" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="loading-u-boot-from-the-emmc">
<h4>Loading U-Boot from the eMMC<a class="headerlink" href="#loading-u-boot-from-the-emmc" title="Permalink to this heading"></a></h4>
<p>The eMMC version of U-Boot is used to boot the OS during the normal boot up process. To access the U-Boot prompt you
will need to interrupt the standard boot process by typing keys into the serial console during boot. U-Boot will detect
the key presses and stop at the U-Boot prompt. <a class="reference internal" href="#uboot-prompt"><span class="std std-ref">U-Boot Prompt with SU-Boot</span></a></p>
</section>
<section id="loading-u-boot-from-internal-spi-flash">
<h4>Loading U-Boot from internal SPI flash<a class="headerlink" href="#loading-u-boot-from-internal-spi-flash" title="Permalink to this heading"></a></h4>
<p>To load U-Boot from the internal SPI flash, insert the the SD_BOOT jumper as described in <a class="reference internal" href="#spi-sd-boot"><span class="std std-ref">Booting from SPI and SD Cards</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that the <code class="docutils literal notranslate"><span class="pre">SD_BOOT</span></code> jumper is not attached when booting from eMMC. Otherwise,
the device will boot from internal SPI flash or an SD Card.</p>
</div>
</section>
<section id="flashing-images-from-a-usb-drive">
<span id="flashing-from-usb-drive"></span><h4>Flashing Images from a USB Drive<a class="headerlink" href="#flashing-images-from-a-usb-drive" title="Permalink to this heading"></a></h4>
<p>To flash an Astra system image from an external USB drive simply copy the image
directory to the USB drive. The USB drive will need a partition with a
Fat32 formatted file system and enough capacity to fit the Astra system image.</p>
<p>Write the image to eMMC using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">usb2emmc</span> <span class="n">eMMCimg</span>
</pre></div>
</div>
<p>The parameter eMMCimg is the name of the image directory on the USB drive.</p>
</section>
<section id="flashing-images-from-a-tftp-server">
<h4>Flashing Images from a TFTP Server<a class="headerlink" href="#flashing-images-from-a-tftp-server" title="Permalink to this heading"></a></h4>
<p>To flash an Astra system image from a TFTP server you will first need to
connect Astra Machina to a local network using the ethernet port. Copy the
Astra image to the TFTP server so that it can be accessed by the device
over the network. Once the device is connected to the network, boot to
the U-Boot prompt.</p>
<p>Initialize networking and request an IP address from a DHCP server on the local network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">net_init</span><span class="p">;</span> <span class="n">dhcp</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">setenv</span> <span class="n">serverip</span> <span class="mf">10.10.10.10</span><span class="p">;</span>
</pre></div>
</div>
<p>Write the image to eMMC from the TFTP server using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">tftp2emmc</span> <span class="n">eMMCimg</span>
</pre></div>
</div>
<p>The parameter eMMCimg is the name of the image directory on the TFTP server.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SPI U-Boot initializes the network and requests an IP automatically.
The <code class="docutils literal notranslate"><span class="pre">net_init</span></code> and <code class="docutils literal notranslate"><span class="pre">dhcp</span></code> commands not needed when using SPI U-Boot.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the examples above the TFTP server’s address is
10.10.10.10. Please replace this IP with the IP address of the server
hosting TFTP.</p>
</div>
</section>
</section>
<section id="updating-internal-spi-flash-images-using-u-boot">
<span id="flash-internal-spi"></span><h3>Updating Internal SPI Flash Images using U-Boot<a class="headerlink" href="#updating-internal-spi-flash-images-using-u-boot" title="Permalink to this heading"></a></h3>
<p>The internal SPI flash on Astra Machina can also be updated using the methods described above.
You can find the latest versions of the SPI images on <a class="reference external" href="https://github.com/synaptics-astra/spi-u-boot">GitHub</a>.</p>
<section id="flashing-image-from-an-external-usb-drive">
<h4>Flashing Image from an External USB Drive<a class="headerlink" href="#flashing-image-from-an-external-usb-drive" title="Permalink to this heading"></a></h4>
<p>To update the internal SPI flash image using an external USB drive, simply copy the image to the drive.
The USB drive will need a partition with a Fat32 formatted file system.</p>
<p>Write the image to SPI flash using the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">usb</span> <span class="n">start</span><span class="p">;</span> <span class="n">fatload</span> <span class="n">usb</span> <span class="mi">0</span> <span class="mh">0x10000000</span> <span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">astra</span><span class="o">-</span><span class="n">v1</span><span class="mf">.1.1</span><span class="o">.</span><span class="n">sl1680</span><span class="o">.</span><span class="n">rdk</span><span class="o">.</span><span class="n">spi</span><span class="o">.</span><span class="n">bin</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">spinit</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">erase</span> <span class="n">f0000000</span> <span class="n">f01fffff</span><span class="p">;</span> <span class="n">cp</span><span class="o">.</span><span class="n">b</span> <span class="mh">0x10000000</span> <span class="mh">0xf0000000</span> <span class="mh">0x200000</span><span class="p">;</span>
</pre></div>
</div>
<p>An optional backup copy of the SPI flash image can be installed using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">erase</span> <span class="n">f0200000</span> <span class="n">f03fffff</span><span class="p">;</span> <span class="n">cp</span><span class="o">.</span><span class="n">b</span> <span class="mh">0x10000000</span> <span class="mh">0xf0200000</span> <span class="mh">0x200000</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="flashing-image-from-tftp-server">
<h4>Flashing Image from TFTP Server<a class="headerlink" href="#flashing-image-from-tftp-server" title="Permalink to this heading"></a></h4>
<p>To update the internal SPI flash image by downloading it from a TFTP server, simply copy the image to
the TFTP server.</p>
<p>Write the SPI image to the SPI flash from the TFTP server using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">net_init</span><span class="p">;</span> <span class="n">dhcp</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">setenv</span> <span class="n">serverip</span> <span class="mf">10.10.10.10</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">tftpboot</span> <span class="mh">0x10000000</span> <span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">astra</span><span class="o">-</span><span class="n">v1</span><span class="mf">.1.1</span><span class="o">.</span><span class="n">sl1680</span><span class="o">.</span><span class="n">rdk</span><span class="o">.</span><span class="n">spi</span><span class="o">.</span><span class="n">bin</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">spinit</span><span class="p">;</span>
<span class="o">=&gt;</span> <span class="n">erase</span> <span class="n">f0000000</span> <span class="n">f01fffff</span><span class="p">;</span> <span class="n">cp</span><span class="o">.</span><span class="n">b</span> <span class="mh">0x10000000</span> <span class="mh">0xf0000000</span> <span class="mh">0x200000</span><span class="p">;</span>
</pre></div>
</div>
<p>An optional backup copy of the SPI flash image can be installed using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=&gt;</span> <span class="n">erase</span> <span class="n">f0200000</span> <span class="n">f03fffff</span><span class="p">;</span> <span class="n">cp</span><span class="o">.</span><span class="n">b</span> <span class="mh">0x10000000</span> <span class="mh">0xf0200000</span> <span class="mh">0x200000</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SPI U-Boot initializes the network and requests an IP automatically.
The <code class="docutils literal notranslate"><span class="pre">net_init</span></code> and <code class="docutils literal notranslate"><span class="pre">dhcp</span></code> commands not needed when using SPI U-Boot.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the examples above the TFTP server’s address is
10.10.10.10. Please replace this IP with the IP address of the server
hosting TFTP.</p>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../quickstart/build_image.html" class="btn btn-neutral float-left" title="Building and installing a custom system image" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../yocto.html" class="btn btn-neutral float-right" title="Astra Yocto Linux Developer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 - 2025, Synaptics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>